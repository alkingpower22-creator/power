<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voxa Store</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a33;
      --card:#111f3d;
      --card2:#0f1b34;
      --text:#eaf0ff;
      --muted:#a9b7d7;
      --brand:#4aa3ff;
      --ok:#29d17d;
      --danger:#ff5c7a;
      --warn:#ffcc66;
      --border:rgba(255,255,255,.10);
      --radius:18px;
      --shadow:0 18px 50px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      background: var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* Layout */
    .app{display:grid;grid-template-columns:320px 1fr;min-height:100vh}
    aside{
      background: var(--panel);
      padding:18px;
      border-left:1px solid var(--border);
      position:sticky; top:0; height:100vh;
      box-shadow: var(--shadow);
    }
    main{padding:24px 24px 40px}

    /* Mobile sidebar */
    @media (max-width:980px){
      .app{grid-template-columns:1fr}
      aside{
        position:fixed; inset:0; width:min(92vw,360px); height:auto;
        transform: translateX(110%); transition:.25s ease; z-index:50;
        border-left:none; border-right:1px solid var(--border);
      }
      aside.open{transform: translateX(0)}
      .overlay{position:fixed; inset:0; background: rgba(0,0,0,.55); z-index:40;
        opacity:0; pointer-events:none; transition:.2s ease;
      }
      .overlay.show{opacity:1; pointer-events:auto}
      main{padding:18px 16px 30px}
      .topbar{display:flex}
    }

    .topbar{
      display:none;
      position:sticky; top:0; z-index:10; padding:14px 16px;
      background: #0b1220;
      border-bottom:1px solid var(--border);
      gap:10px; align-items:center; justify-content:space-between;
    }
    .burger{border:1px solid var(--border); background: var(--card2); color:var(--text);
      border-radius:14px; padding:10px 12px; cursor:pointer; font-weight:900;
    }
    .overlay{display:block}

    /* Header blocks */
    .logo{
      display:flex; gap:12px; align-items:center; padding:14px;
      border:1px solid var(--border); border-radius: var(--radius);
      background: var(--card2);
      box-shadow: var(--shadow);
    }
    .badge{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, rgba(74,163,255,.95), rgba(41,209,125,.8));
      display:grid; place-items:center; font-weight:900;
    }
    .logo h1{margin:0; font-size:16px}
    .logo p{margin:3px 0 0; color:var(--muted); font-size:12px; line-height:1.6}

    nav{margin-top:16px; display:flex; flex-direction:column; gap:10px}
    .navbtn{
      display:flex; gap:10px; align-items:center; width:100%;
      padding:12px 14px; border-radius:16px; border:1px solid var(--border);
      background: var(--card2); color:var(--text); cursor:pointer; text-align:right;
      transition:.15s ease;
    }
    .navbtn:hover{transform: translateY(-1px)}
    .navbtn.active{background: rgba(74,163,255,.18); border-color: rgba(74,163,255,.40)}
    .navicon{
      width:34px; height:34px; border-radius:12px; background: #0b142b;
      display:grid; place-items:center; border:1px solid var(--border); flex:0 0 auto;
    }
    .navtext .t{font-weight:900}
    .navtext .d{font-size:12px; color:var(--muted); margin-top:2px}

    .sidecard{
      margin-top:14px; padding:14px; border-radius: var(--radius);
      border:1px solid var(--border); background: var(--card2);
    }
    .small{color:var(--muted); font-size:12px; line-height:1.7}

    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:14px;
      border:1px solid var(--border);
      background: #0b142b;
      color:var(--muted);
      font-size:12px;
      font-weight:900;
    }
    .btn{
      cursor:pointer; border:1px solid var(--border); background: var(--card2);
      color:var(--text); padding:10px 12px; border-radius:14px; font-weight:900;
    }
    .btn.primary{border-color: rgba(74,163,255,.50); background: rgba(74,163,255,.16)}
    .btn.ok{border-color: rgba(41,209,125,.50); background: rgba(41,209,125,.14)}
    .btn.danger{border-color: rgba(255,92,122,.50); background: rgba(255,92,122,.14)}
    .btn.small{padding:8px 10px; border-radius:12px; font-weight:800}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    .pagehead{display:flex; justify-content:space-between; align-items:flex-start; gap:16px; margin-bottom:14px}
    .pagehead h2{margin:0; font-size:24px}
    .pagehead p{margin:6px 0 0; color:var(--muted); line-height:1.8; max-width:70ch}
    .chiprow{display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end}
    .chip{font-size:12px; padding:7px 10px; border-radius:999px; border:1px solid var(--border);
      background: var(--card2); color:var(--muted);
    }

    .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin-top:16px}
    .card{
      grid-column: span 6; padding:16px; border-radius: var(--radius); border:1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow); min-height:120px;
    }
    .card.full{grid-column:span 12}
    .card h3{margin:0 0 8px; font-size:16px}
    .card p{margin:0; color:var(--muted); line-height:1.8}

    .meta{margin-top:12px; display:flex; gap:8px; flex-wrap:wrap}
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background: var(--card2); color:var(--muted)}
    .tag.ok{color:var(--ok); border-color: rgba(41,209,125,.35); background: rgba(41,209,125,.12)}
    .tag.warn{color:var(--warn); border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.12)}
    .tag.danger{color:var(--danger); border-color: rgba(255,92,122,.35); background: rgba(255,92,122,.12)}

    @media (max-width:980px){
      .card{grid-column: span 12}
      .pagehead{flex-direction:column; align-items:flex-start}
      .chiprow{justify-content:flex-start}
    }

    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:14px}
    .tab{
      border:1px solid var(--border); background: var(--card2); color:var(--text);
      padding:8px 10px; border-radius:999px; font-weight:900; cursor:pointer; font-size:12px;
    }
    .tab.active{border-color: rgba(74,163,255,.45); background: rgba(74,163,255,.16)}

    .emptybox{
      grid-column: span 12; padding:18px; border-radius: var(--radius);
      border:1px dashed rgba(255,255,255,.18); background: var(--card2);
      color: var(--muted); line-height:1.9;
    }

    form{
      margin-top:12px; max-width: 820px; border:1px solid var(--border);
      border-radius: var(--radius); background: var(--card);
      padding:16px; box-shadow: var(--shadow);
    }
    .fgrid{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width:980px){ .fgrid{grid-template-columns:1fr} }
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input, textarea, select{
      width:100%; border-radius: 14px; border:1px solid var(--border);
      background: #0b142b; padding:10px 12px; color:var(--text);
      outline:none; font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}

    /* Lists */
    .list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .item{
      border:1px solid var(--border);
      background: var(--card2);
      border-radius:16px;
      padding:12px;
    }
    .itemTop{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .itemTitle{font-weight:900}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    @media (max-width:520px){
      .actions .btn{flex:1 1 auto}
    }

    .status{
      font-weight:900;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background: #0b142b;
      font-size:12px;
    }
    .s-open{color:var(--warn)}
    .s-done{color:var(--ok)}
    .s-closed{color:var(--danger)}

    /* Pages */
    section.page{display:none}
    section.page.active{display:block}

    /* Simple divider */
    .hr{height:1px;background: var(--border);margin:12px 0}

    /* Hide helper */
    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="topbar">
    <button class="burger" id="openMenu">â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    <div style="font-weight:900">Voxa Store</div>
  </div>
  <div class="overlay" id="overlay"></div>

  <div class="app">
    <aside id="sidebar">
      <div class="logo">
        <div class="badge">VX</div>
        <div>
          <h1>Voxa Store</h1>
          <p>Marketplace Ø±Ø³Ù…ÙŠ</p>
        </div>
      </div>

      <div class="sidecard">
        <div class="row">
          <span class="pill" id="loginPill">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn primary small" id="loginDiscordBtn">ØªØ³Ø¬ÙŠÙ„ Discord</button>
            <button class="btn danger small hidden" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>
        <div class="small" style="margin-top:10px">
          * Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨ØªØªØ­Ø¯Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Discord ID.
        </div>
      </div>

      <nav id="nav"></nav>

      <div class="sidecard">
        <div class="small">
          Ø£ÙˆÙ„ Ù…Ø±Ø© Ù„Ù„Ø£ÙˆÙ†Ø±: Ø§ÙØªØ­ Console ÙˆØ§ÙƒØªØ¨:
          <div class="hr"></div>
          <b style="color:var(--text)">voxaSetOwners(["YOUR_ID"])</b>
        </div>
      </div>
    </aside>

    <main>
      <!-- ===== PUBLIC PAGES ===== -->

      <!-- ABOUT (Ø±Ø¬Ø¹ Ø²ÙŠ Ø§Ù„Ø£ÙˆÙ„) -->
      <section class="page active" id="page-about">
        <div class="pagehead">
          <div>
            <h2>About us</h2>
            <p>
              Ø¥Ø­Ù†Ø§ Voxa Store â€” Ø£Ø­Ø³Ù† Ø³ØªÙˆØ± ÙÙŠ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· ğŸ”¥<br/>
              Ù…Ø¹Ø§Ù†Ø§ <b>190 Ø¯Ù„ÙŠÙ„</b> ÙˆØ¨Ø§Ø¦Ø¹ÙŠÙ† Ø¬Ø§Ù…Ø¯ÙŠÙ† Ø¬Ø¯Ù‹Ø§ØŒ Ø´ØºØ§Ù„ÙŠÙ† <b>24 Ø³Ø§Ø¹Ø©</b>.
            </p>
          </div>
          <div class="chiprow">
            <span class="chip">ğŸ“˜ 190 Ø¯Ù„ÙŠÙ„</span>
            <span class="chip">ğŸ”¥ Sellers Ø¬Ø§Ù…Ø¯ÙŠÙ†</span>
            <span class="chip">â±ï¸ 24/7</span>
          </div>
        </div>

        <div class="grid">
          <div class="card">
            <h3>Ù„ÙŠÙ‡ Ø¥Ø­Ù†Ø§ØŸ</h3>
            <p>ØªÙ†Ø¸ÙŠÙ…ØŒ Ø³Ø±Ø¹Ø©ØŒ Ø¯Ø¹Ù… Ù…Ø­ØªØ±Ù…ØŒ ÙˆØªØ¬Ø±Ø¨Ø© Ø´ÙƒÙ„Ù‡Ø§ Ø¬Ø§Ù…Ø¯.</p>
            <div class="meta">
              <span class="tag">Ø«Ù‚Ø©</span><span class="tag">Ø³Ø±Ø¹Ø©</span><span class="tag">Ø¯Ø¹Ù…</span>
            </div>
          </div>
          <div class="card">
            <h3>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´ÙˆØ¨</h3>
            <p>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ØªØªØ­Ø· Ù…Ù† Owner Panel ÙˆØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠ.</p>
            <div class="meta">
              <span class="tag">Supplies</span><span class="tag">Orders</span><span class="tag">Issues</span>
            </div>
          </div>
        </div>
      </section>

      <!-- SHOP -->
      <section class="page" id="page-shop">
        <div class="pagehead">
          <div>
            <h2>Shop</h2>
            <p>Ø§Ø®ØªØ§Ø± Ù‚Ø³Ù… ÙˆØ´ÙˆÙ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ Ù„Ù„Ø³Ù„Ø© Ø£Ùˆ ØªØ´ØªØ±ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="shopCountChip">â€¦</span>
          </div>
        </div>

        <div class="tabs" id="categoryTabs"></div>
        <div class="grid" id="shopGrid"></div>

        <div class="grid">
          <div class="card full">
            <h3>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h3>
            <div id="cartList" style="margin-top:10px;color:var(--muted)">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.</div>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;align-items:center">
              <span style="font-weight:900" id="cartTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 EGP</span>
              <button class="btn ok" id="checkoutBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
              <button class="btn small" id="clearCartBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
            </div>

            <div class="hidden" id="checkoutBox" style="margin-top:14px">
              <div class="card full" style="background: var(--card2)">
                <h3>ğŸ§¾ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</h3>

                <div class="fgrid" style="margin-top:12px">
                  <div>
                    <label>Ø§Ø³Ù…Ùƒ</label>
                    <input id="coName" placeholder="Ø§Ø³Ù…Ùƒ" />
                  </div>
                  <div>
                    <label>ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„</label>
                    <input id="coContact" placeholder="Discord/Ø±Ù‚Ù…..." />
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                  <select id="coPay"></select>
                </div>

                <button class="btn primary" id="confirmOrderBtn" style="margin-top:12px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
                <p id="coNote" style="margin-top:10px;color:var(--muted)"></p>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- SELLERS -->
      <section class="page" id="page-sellers">
        <div class="pagehead">
          <div>
            <h2>Sellers</h2>
            <p>Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ø¹Ù†Ø¯Ù†Ø§.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="sellersCountChip">â€¦</span>
          </div>
        </div>

        <div class="grid" id="sellersGrid"></div>
      </section>

      <!-- PROOFS -->
      <section class="page" id="page-proofs">
        <div class="pagehead">
          <div>
            <h2>Proofs</h2>
            <p>Ø·Ù„Ø¨Ø§Øª Ø§ØªØ³Ù„Ù…Øª ÙˆØªÙ…Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="proofsCountChip">â€¦</span>
          </div>
        </div>

        <div class="list" id="proofsList"></div>
      </section>

      <!-- PAYMENTS -->
      <section class="page" id="page-payments">
        <div class="pagehead">
          <div>
            <h2>Payments</h2>
            <p>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø© (Ø¨ØªØªØ¯Ø§Ø± Ù…Ù† Owner).</p>
          </div>
          <div class="chiprow">
            <span class="chip">ğŸ’³ Ø¯ÙØ¹</span>
          </div>
        </div>

        <div class="grid" id="paymentsGrid"></div>
      </section>

      <!-- SUPPORT -->
      <section class="page" id="page-support">
        <div class="pagehead">
          <div>
            <h2>Support</h2>
            <p>Ù‚Ø¯Ù‘Ù… Ù…Ø´ÙƒÙ„Ø©/ØªØ°ÙƒØ±Ø©ØŒ ÙˆÙ‡ØªÙˆØµÙ„ Ù„Ù„Ø£ÙˆÙ†Ø± ÙÙŠ Issues.</p>
          </div>
          <div class="chiprow">
            <span class="chip">ğŸ§¾ Issues</span>
            <span class="chip">âš¡ Ø±Ø¯ Ø³Ø±ÙŠØ¹</span>
          </div>
        </div>

        <form id="issueForm">
          <div class="fgrid">
            <div>
              <label>Ø§Ø³Ù…Ùƒ</label>
              <input name="name" required placeholder="Ø§Ø³Ù…Ùƒ" />
            </div>
            <div>
              <label>ÙˆØ³ÙŠÙ„Ø© ØªÙˆØ§ØµÙ„ (Discord/Ø±Ù‚Ù…/Ø¥ÙŠÙ…ÙŠÙ„)</label>
              <input name="contact" required placeholder="discordUser" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <select name="type" required>
              <option value="payment">Ù…Ø´ÙƒÙ„Ø© Ø¯ÙØ¹</option>
              <option value="order">Ù…Ø´ÙƒÙ„Ø© Ø·Ù„Ø¨</option>
              <option value="seller">Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ø¦Ø¹</option>
              <option value="other">Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>

          <div style="margin-top:12px">
            <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <textarea name="details" required placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„â€¦"></textarea>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn ok" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>
            <button class="btn small" type="reset">Ù…Ø³Ø­</button>
          </div>

          <p class="small" id="issueNote" style="margin-top:10px"></p>
        </form>
      </section>


      <!-- ===== SELLER PANEL (Ù„Ù„Ù€ seller ÙÙ‚Ø·) ===== -->
      <section class="page" id="page-seller-orders">
        <div class="pagehead">
          <div>
            <h2>Seller â€” Orders</h2>
            <p>Ù‡Ù†Ø§ Ø¨ØªØ´ÙˆÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ÙŠ ØªØ®ØµÙƒ (Ø­Ø³Ø¨ Seller username ÙÙŠ Ø§Ù„Ø·Ù„Ø¨).</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="sellerOrdersChip">â€¦</span>
          </div>
        </div>
        <div class="list" id="sellerOrdersList"></div>
      </section>

      <section class="page" id="page-seller-supplies">
        <div class="pagehead">
          <div>
            <h2>Seller â€” Supplies</h2>
            <p>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (ØªØ±ÙˆØ­ Pending Ø¹Ù†Ø¯ Ø§Ù„Ø£ÙˆÙ†Ø± Ø¹Ø´Ø§Ù† ÙŠÙˆØ§ÙÙ‚).</p>
          </div>
          <div class="chiprow">
            <span class="chip">â³ Pending Approval</span>
          </div>
        </div>

        <form id="sellerSupplyForm">
          <div class="fgrid">
            <div>
              <label>Ø§Ù„Ù‚Ø³Ù…</label>
              <select id="sellerSupCategory"></select>
            </div>
            <div>
              <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
              <input id="sellerSupTitle" placeholder="Nitro 1 Month" />
            </div>
          </div>

          <div class="fgrid" style="margin-top:12px">
            <div>
              <label>Ø§Ù„Ø³Ø¹Ø± (EGP)</label>
              <input id="sellerSupPrice" type="number" min="1" placeholder="250" />
            </div>
            <div>
              <label>ÙˆØµÙ</label>
              <input id="sellerSupDesc" placeholder="ÙˆØµÙ Ø³Ø±ÙŠØ¹â€¦" />
            </div>
          </div>

          <button class="btn primary" type="submit" style="margin-top:12px">+ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</button>
          <p class="small" id="sellerSupNote" style="margin-top:10px"></p>
        </form>

        <div class="hr"></div>
        <div class="list" id="sellerPendingList"></div>
      </section>


      <!-- ===== OWNER PANEL (Ù„Ù„Ù€ owner ÙÙ‚Ø·) ===== -->
      <section class="page" id="page-owner-supplies">
        <div class="pagehead">
          <div>
            <h2>Owner â€” Supplies</h2>
            <p>ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª + Ù‚Ø¨ÙˆÙ„ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† (Pending).</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="ownerSupChip">â€¦</span>
          </div>
        </div>

        <div class="grid">
          <div class="card full">
            <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ø¨Ø§Ø´Ø±</h3>

            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Ø§Ù„Ù‚Ø³Ù…</label>
                <select id="ownSupCategory"></select>
              </div>
              <div>
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                <input id="ownSupTitle" placeholder="Nitro 1 Month" />
              </div>
            </div>

            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Ø§Ù„Ø³Ø¹Ø± (EGP)</label>
                <input id="ownSupPrice" type="number" min="1" placeholder="250" />
              </div>
              <div>
                <label>Seller username</label>
                <input id="ownSupSeller" placeholder="gq_8" />
              </div>
            </div>

            <div style="margin-top:12px">
              <label>ÙˆØµÙ</label>
              <textarea id="ownSupDesc" placeholder="ÙˆØµÙ Ø³Ø±ÙŠØ¹â€¦"></textarea>
            </div>

            <button class="btn ok" id="ownAddSupplyBtn" style="margin-top:12px">+ Ø¥Ø¶Ø§ÙØ©</button>
            <p class="small" id="ownSupNote" style="margin-top:10px"></p>
          </div>
        </div>

        <div class="hr"></div>
        <h3 style="margin:0 0 10px">â³ Pending Supplies</h3>
        <div class="list" id="ownerPendingList"></div>

        <div class="hr"></div>
        <h3 style="margin:0 0 10px">ğŸ“¦ Current Supplies</h3>
        <div class="list" id="ownerSuppliesList"></div>
      </section>

      <section class="page" id="page-owner-members">
        <div class="pagehead">
          <div>
            <h2>Owner â€” Members</h2>
            <p>Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù Sellers IDs + Ø¥Ø¶Ø§ÙØ© Owners IDs.</p>
          </div>
          <div class="chiprow">
            <span class="chip">Owners / Sellers IDs</span>
          </div>
        </div>

        <div class="grid">
          <div class="card full">
            <h3>Ø¥Ø¶Ø§ÙØ© Seller ID</h3>
            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Discord User ID</label>
                <input id="addSellerIdInput" placeholder="Ù…Ø«Ø§Ù„: 1234567890" />
              </div>
              <div>
                <label>Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</label>
                <button class="btn primary" id="addSellerIdBtn">+ Ø¥Ø¶Ø§ÙØ©</button>
              </div>
            </div>
            <div class="hr"></div>
            <div class="list" id="sellerIdsList"></div>
          </div>

          <div class="card full">
            <h3>Ø¥Ø¶Ø§ÙØ© Owner ID</h3>
            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Discord User ID</label>
                <input id="addOwnerIdInput" placeholder="Ù…Ø«Ø§Ù„: 1234567890" />
              </div>
              <div>
                <label>Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</label>
                <button class="btn ok" id="addOwnerIdBtn">+ Ø¥Ø¶Ø§ÙØ©</button>
              </div>
            </div>
            <div class="hr"></div>
            <div class="list" id="ownerIdsList"></div>
          </div>
        </div>

        <div class="small">
          * ØªÙ‚Ø¯Ø± ØªØ¬ÙŠØ¨ Discord ID Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Discord â†’ Advanced â†’ Developer Mode Ø«Ù… Copy ID.
        </div>
      </section>

      <section class="page" id="page-owner-issues">
        <div class="pagehead">
          <div>
            <h2>Owner â€” Issues</h2>
            <p>Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ/Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù„ÙŠ Ø¬Ø§ÙŠØ© Ù…Ù† Support.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="issuesChip">â€¦</span>
          </div>
        </div>
        <div class="list" id="issuesList"></div>
      </section>

      <section class="page" id="page-owner-payments">
        <div class="pagehead">
          <div>
            <h2>Owner â€” Payments Status</h2>
            <p>ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù„ÙŠ ØªØ¸Ù‡Ø± Ù„Ù„Ù†Ø§Ø³.</p>
          </div>
          <div class="chiprow">
            <span class="chip">Enable / Disable</span>
          </div>
        </div>
        <div class="list" id="paymentsAdminList"></div>
      </section>

    </main>
  </div>

  <script>
    // ===== Mobile Sidebar =====
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const openMenu = document.getElementById("openMenu");
    openMenu?.addEventListener("click", ()=>{ sidebar.classList.add("open"); overlay.classList.add("show"); });
    overlay?.addEventListener("click", ()=>{ sidebar.classList.remove("open"); overlay.classList.remove("show"); });

    // ===== Storage Keys =====
    const KEY_SESSION       = "voxa_session";
    const KEY_OWNERS        = "voxa_owners";        // array of discord ids
    const KEY_SELLERS_IDS   = "voxa_seller_ids";    // array of discord ids
    const KEY_SELLERS_NAMES = "voxa_sellers";       // array of seller usernames for public page
    const KEY_SUPPLY        = "voxa_supplies";      // approved supplies
    const KEY_SUPPLY_PEND   = "voxa_supplies_pending"; // pending by sellers
    const KEY_ISSUES        = "voxa_issues";
    const KEY_ORDERS        = "voxa_orders";
    const KEY_PROOFS        = "voxa_proofs";
    const KEY_CART          = "voxa_cart";
    const KEY_PAYMENTS_CFG  = "voxa_payments_cfg";  // enabled methods

    const DEFAULT_SELLERS_NAMES = ["gq_8", "k_i_l_"];
    const CATEGORIES = ["nitros","credits","visas","effects","boosts","accounts"];

    const PAYMENT_METHODS = [
      { key:"crypto", label:"ÙƒØ±ÙŠØ¨ØªÙˆ (USDT / TRC20 / ERC20â€¦)" },
      { key:"instapay", label:"Ø¥Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ" },
      { key:"paypal", label:"Ø¨Ø§ÙŠØ¨Ø§Ù„" },
      { key:"vodafone", label:"ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´" },
      { key:"sar", label:"Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª)" },
      { key:"asiacell", label:"Ø¢Ø³ÙŠØ§ Ø³ÙŠÙ„ (ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª)" }
    ];

    // ===== Discord OAuth2 (Implicit Grant) =====
    // Ø­Ø· Client ID Ø¨ØªØ§Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ù‡Ù†Ø§:
    const DISCORD_CLIENT_ID = "1467767591668809929";
    const DISCORD_REDIRECT_URI = location.origin + location.pathname;
    const DISCORD_SCOPES = "identify";

    function esc(s){
      return String(s||"")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function safeJSONParse(raw, fallback){
      try{ return JSON.parse(raw); }catch{ return fallback; }
    }
    const uid = (p)=> p + "_" + Math.random().toString(16).slice(2) + Date.now().toString(16);

    function getSession(){ return safeJSONParse(localStorage.getItem(KEY_SESSION) || "null", null); }
    function setSession(s){ localStorage.setItem(KEY_SESSION, JSON.stringify(s)); }
    function clearSession(){ localStorage.removeItem(KEY_SESSION); }

    function parseTokenFromHash(){
      const h = new URLSearchParams((location.hash || "").replace("#",""));
      const token = h.get("access_token");
      if(token){
        history.replaceState(null, "", location.pathname + location.search);
      }
      return token;
    }
    async function fetchDiscordMe(token){
      const res = await fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${token}` }
      });
      if(!res.ok) throw new Error("discord_me_failed");
      return await res.json();
    }
    function oauthLogin(){
      if(!DISCORD_CLIENT_ID || DISCORD_CLIENT_ID === "PUT_CLIENT_ID_HERE"){
        alert("Ø­Ø· DISCORD_CLIENT_ID ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„.");
        return;
      }
      const url =
        `https://discord.com/oauth2/authorize?client_id=${encodeURIComponent(DISCORD_CLIENT_ID)}` +
        `&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}` +
        `&response_type=token&scope=${encodeURIComponent(DISCORD_SCOPES)}`;
      location.href = url;
    }
    function getRoleById(discordId){
      const owners = safeJSONParse(localStorage.getItem(KEY_OWNERS) || "[]", []);
      const sellers = safeJSONParse(localStorage.getItem(KEY_SELLERS_IDS) || "[]", []);
      if(Array.isArray(owners) && owners.includes(discordId)) return "owner";
      if(Array.isArray(sellers) && sellers.includes(discordId)) return "seller";
      return "public";
    }

    // Public helper: set owners once
    window.voxaSetOwners = function(arr){
      if(!Array.isArray(arr) || !arr.length) return alert("Ø­Ø· Array ÙÙŠÙ‡Ø§ IDs");
      localStorage.setItem(KEY_OWNERS, JSON.stringify(arr.map(String)));
      alert("âœ… ØªÙ… Ø­ÙØ¸ Owners IDs");
      location.reload();
    };

    // Boot auth
    (async function bootAuth(){
      const token = parseTokenFromHash();
      if(token){
        try{
          const me = await fetchDiscordMe(token);
          const role = getRoleById(me.id);
          setSession({ token, me, role, at: new Date().toISOString() });
        }catch{
          clearSession();
        }
      }
    })();

    // ===== Ensure defaults =====
    if(!localStorage.getItem(KEY_SELLERS_NAMES)) localStorage.setItem(KEY_SELLERS_NAMES, JSON.stringify(DEFAULT_SELLERS_NAMES));
    if(!localStorage.getItem(KEY_SUPPLY)) localStorage.setItem(KEY_SUPPLY, JSON.stringify([]));
    if(!localStorage.getItem(KEY_SUPPLY_PEND)) localStorage.setItem(KEY_SUPPLY_PEND, JSON.stringify([]));
    if(!localStorage.getItem(KEY_ISSUES)) localStorage.setItem(KEY_ISSUES, JSON.stringify([]));
    if(!localStorage.getItem(KEY_ORDERS)) localStorage.setItem(KEY_ORDERS, JSON.stringify([]));
    if(!localStorage.getItem(KEY_PROOFS)) localStorage.setItem(KEY_PROOFS, JSON.stringify([]));
    if(!localStorage.getItem(KEY_PAYMENTS_CFG)){
      const cfg = {};
      PAYMENT_METHODS.forEach(m=> cfg[m.key]=true);
      localStorage.setItem(KEY_PAYMENTS_CFG, JSON.stringify(cfg));
    }

    // ===== UI refs =====
    const loginPill = document.getElementById("loginPill");
    const loginDiscordBtn = document.getElementById("loginDiscordBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    loginDiscordBtn.onclick = ()=> oauthLogin();
    logoutBtn.onclick = ()=>{ clearSession(); location.reload(); };

    function renderLoginStatus(){
      const s = getSession();
      if(!s || !s.me){
        loginPill.textContent = "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
        logoutBtn.classList.add("hidden");
        return;
      }
      loginPill.textContent = `@${s.me.username} âœ…`;
      logoutBtn.classList.remove("hidden");
    }

    // ===== Pages / Nav (Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©) =====
    const nav = document.getElementById("nav");

    const pages = {
      about: document.getElementById("page-about"),
      shop: document.getElementById("page-shop"),
      sellers: document.getElementById("page-sellers"),
      proofs: document.getElementById("page-proofs"),
      payments: document.getElementById("page-payments"),
      support: document.getElementById("page-support"),

      seller_orders: document.getElementById("page-seller-orders"),
      seller_supplies: document.getElementById("page-seller-supplies"),

      owner_supplies: document.getElementById("page-owner-supplies"),
      owner_members: document.getElementById("page-owner-members"),
      owner_issues: document.getElementById("page-owner-issues"),
      owner_payments: document.getElementById("page-owner-payments"),
    };

    function hideAllPages(){
      Object.values(pages).forEach(p=> p && p.classList.remove("active"));
    }
    function setActivePage(key){
      hideAllPages();
      pages[key]?.classList.add("active");
      document.querySelectorAll(".navbtn").forEach(b=> b.classList.toggle("active", b.dataset.page === key));
      history.replaceState(null, "", "#" + key);
      if (window.innerWidth <= 980){
        sidebar.classList.remove("open");
        overlay.classList.remove("show");
      }
    }

    function buildNav(){
      const s = getSession();
      const role = (s && s.me) ? s.role : "public";

      const publicLinks = [
        { key:"about", icon:"â„¹ï¸", t:"About us", d:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª" },
        { key:"shop", icon:"ğŸ›’", t:"Shop", d:"Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª + Ø§Ù„Ø³Ù„Ø©" },
        { key:"sellers", icon:"ğŸ‘¤", t:"Sellers", d:"Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†" },
        { key:"proofs", icon:"âœ…", t:"Proofs", d:"Ø·Ù„Ø¨Ø§Øª Ø§ØªØ³Ù„Ù…Øª" },
        { key:"payments", icon:"ğŸ’³", t:"Payments", d:"Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹" },
        { key:"support", icon:"ğŸ› ï¸", t:"Support", d:"ØªÙ‚Ø¯ÙŠÙ… Ù…Ø´ÙƒÙ„Ø©" },
      ];

      const sellerLinks = [
        { key:"seller_orders", icon:"ğŸ“¦", t:"Orders", d:"Ø·Ù„Ø¨Ø§ØªÙƒ" },
        { key:"seller_supplies", icon:"â•", t:"Supplies", d:"Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª (Pending)" },
      ];

      const ownerLinks = [
        { key:"owner_supplies", icon:"ğŸ§ ", t:"Supplies", d:"ØªØ­ÙƒÙ… + Ù…ÙˆØ§ÙÙ‚Ø§Øª" },
        { key:"owner_members", icon:"ğŸ‘‘", t:"Members", d:"Sellers/Owners IDs" },
        { key:"owner_issues", icon:"ğŸ§¾", t:"Issues", d:"Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ" },
        { key:"owner_payments", icon:"ğŸ’³", t:"Payments Status", d:"ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù" },
      ];

      let links = [...publicLinks];
      if(role === "seller") links = [...publicLinks, ...sellerLinks];
      if(role === "owner") links = [...publicLinks, ...sellerLinks, ...ownerLinks];

      nav.innerHTML = links.map(l=>`
        <button class="navbtn" data-page="${l.key}">
          <div class="navicon">${l.icon}</div>
          <div class="navtext"><div class="t">${l.t}</div><div class="d">${l.d}</div></div>
        </button>
      `).join("");

      nav.querySelectorAll(".navbtn").forEach(btn=>{
        btn.addEventListener("click", ()=> setActivePage(btn.dataset.page));
      });
    }

    // ===== Data loaders =====
    function loadSupplies(){ return safeJSONParse(localStorage.getItem(KEY_SUPPLY) || "[]", []); }
    function saveSupplies(arr){ localStorage.setItem(KEY_SUPPLY, JSON.stringify(arr)); }

    function loadPendingSupplies(){ return safeJSONParse(localStorage.getItem(KEY_SUPPLY_PEND) || "[]", []); }
    function savePendingSupplies(arr){ localStorage.setItem(KEY_SUPPLY_PEND, JSON.stringify(arr)); }

    function loadSellersNames(){
      const raw = localStorage.getItem(KEY_SELLERS_NAMES);
      const arr = raw ? safeJSONParse(raw, DEFAULT_SELLERS_NAMES) : DEFAULT_SELLERS_NAMES;
      return Array.isArray(arr) && arr.length ? arr : DEFAULT_SELLERS_NAMES;
    }
    function saveSellersNames(arr){ localStorage.setItem(KEY_SELLERS_NAMES, JSON.stringify(arr)); }

    function loadOrders(){ return safeJSONParse(localStorage.getItem(KEY_ORDERS) || "[]", []); }
    function saveOrders(arr){ localStorage.setItem(KEY_ORDERS, JSON.stringify(arr)); }

    function loadProofs(){ return safeJSONParse(localStorage.getItem(KEY_PROOFS) || "[]", []); }
    function saveProofs(arr){ localStorage.setItem(KEY_PROOFS, JSON.stringify(arr)); }

    function loadIssues(){ return safeJSONParse(localStorage.getItem(KEY_ISSUES) || "[]", []); }
    function saveIssues(arr){ localStorage.setItem(KEY_ISSUES, JSON.stringify(arr)); }

    function loadPaymentsCfg(){ return safeJSONParse(localStorage.getItem(KEY_PAYMENTS_CFG) || "{}", {}); }
    function savePaymentsCfg(cfg){ localStorage.setItem(KEY_PAYMENTS_CFG, JSON.stringify(cfg)); }

    // ===== Public: Sellers page =====
    const sellersGrid = document.getElementById("sellersGrid");
    const sellersCountChip = document.getElementById("sellersCountChip");

    function renderSellers(){
      const sellers = loadSellersNames();
      sellersCountChip.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†: ${sellers.length}`;
      sellersGrid.innerHTML = sellers.map(u=>`
        <div class="card">
          <h3>@${esc(u)}</h3>
          <p>Ø¨Ø§Ø¦Ø¹ Ù…Ø¹ØªÙ…Ø¯ Ø¯Ø§Ø®Ù„ Voxa Store.</p>
          <div class="meta">
            <span class="tag ok">Verified</span>
            <span class="tag">24/7</span>
          </div>
        </div>
      `).join("");
    }

    // ===== Public: Proofs =====
    const proofsList = document.getElementById("proofsList");
    const proofsCountChip = document.getElementById("proofsCountChip");

    function renderProofs(){
      const list = loadProofs();
      proofsCountChip.textContent = `Ø¹Ø¯Ø¯: ${list.length}`;
      proofsList.innerHTML = list.length ? list.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.details)}</div>
            <span class="status s-done">done</span>
          </div>
          <div class="small" style="margin-top:6px">
            Ø§Ù„Ø¹Ù…ÙŠÙ„: <b style="color:var(--text)">${esc(p.customer)}</b> â€”
            ØªÙˆØ§ØµÙ„: <b style="color:var(--text)">${esc(p.contact)}</b><br/>
            Seller: <b style="color:var(--text)">@${esc(p.seller || "â€”")}</b><br/>
            ÙˆÙ‚Øª: ${new Date(p.at).toLocaleString()}
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Proofs.</div>`;
    }

    // ===== Payments (Public view uses enabled cfg) =====
    const paymentsGrid = document.getElementById("paymentsGrid");
    const coPay = document.getElementById("coPay");

    function renderPayments(){
      const cfg = loadPaymentsCfg();
      const enabled = PAYMENT_METHODS.filter(m=> cfg[m.key] !== false);

      paymentsGrid.innerHTML = enabled.length ? enabled.map(m=>`
        <div class="card">
          <h3>${esc(m.label)}</h3>
          <p>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„ØªØ£ÙƒÙŠØ¯.</p>
          <div class="meta"><span class="tag ok">Ù…ØªØ§Ø­</span></div>
        </div>
      `).join("") : `
        <div class="emptybox">
          ÙƒÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù‚ÙÙˆÙ„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§. Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ Ø¨Ø¹Ø¯ÙŠÙ†.
        </div>
      `;

      // checkout select
      coPay.innerHTML = enabled.length
        ? enabled.map(m=> `<option value="${esc(m.key)}">${esc(m.label)}</option>`).join("")
        : `<option value="" disabled selected>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù‚ÙÙˆÙ„Ø©</option>`;
    }

    // ===== Shop / Cart =====
    const categoryTabs = document.getElementById("categoryTabs");
    const shopGrid = document.getElementById("shopGrid");
    const shopCountChip = document.getElementById("shopCountChip");

    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");
    const checkoutBox = document.getElementById("checkoutBox");

    const confirmOrderBtn = document.getElementById("confirmOrderBtn");
    const coName = document.getElementById("coName");
    const coContact = document.getElementById("coContact");
    const coNote = document.getElementById("coNote");

    let activeCategory = CATEGORIES[0];

    function loadCart(){
      return safeJSONParse(localStorage.getItem(KEY_CART) || "[]", []);
    }
    function saveCart(arr){ localStorage.setItem(KEY_CART, JSON.stringify(arr)); }
    function cartTotalEGP(cart){
      return cart.reduce((sum,it)=> sum + (Number(it.price)||0) * (Number(it.qty)||1), 0);
    }

    function renderCart(){
      const cart = loadCart();
      if(!cart.length){
        cartList.textContent = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.";
        cartTotal.textContent = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 EGP";
        return;
      }
      cartList.innerHTML = cart.map((it,idx)=>`
        <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:10px">
          <div>
            <b style="color:var(--text)">${esc(it.title)}</b>
            <span class="tag">${Number(it.price)||0} EGP</span>
            <span class="tag">x${Number(it.qty)||1}</span>
          </div>
          <div class="actions">
            <button class="btn small" data-minus="${idx}">-</button>
            <button class="btn small" data-plus="${idx}">+</button>
            <button class="btn small danger" data-remove="${idx}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("");

      cartTotal.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${cartTotalEGP(cart)} EGP`;

      cartList.querySelectorAll("[data-plus]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.plus);
          const c=loadCart();
          c[i].qty = (c[i].qty||1)+1;
          saveCart(c); renderCart();
        };
      });
      cartList.querySelectorAll("[data-minus]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.minus);
          const c=loadCart();
          c[i].qty = Math.max(1,(c[i].qty||1)-1);
          saveCart(c); renderCart();
        };
      });
      cartList.querySelectorAll("[data-remove]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.remove);
          const c=loadCart();
          c.splice(i,1);
          saveCart(c); renderCart();
        };
      });
    }

    function addToCart(prod){
      const cart = loadCart();
      const found = cart.find(x=>x.id===prod.id);
      if(found) found.qty = (found.qty||1)+1;
      else cart.push({ ...prod, qty:1 });
      saveCart(cart);
      renderCart();
    }

    function renderShop(){
      categoryTabs.innerHTML = CATEGORIES.map(c=>`
        <button class="tab ${c===activeCategory ? "active":""}" data-cat="${c}">${c}</button>
      `).join("");
      categoryTabs.querySelectorAll("[data-cat]").forEach(b=>{
        b.onclick=()=>{ activeCategory = b.dataset.cat; renderShop(); };
      });

      const all = loadSupplies();
      const items = all.filter(p => p.category === activeCategory);
      shopCountChip.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${all.length}`;

      if(!items.length){
        shopGrid.innerHTML = `
          <div class="emptybox">
            <b style="color:var(--text)">Ù‚Ø³Ù…: ${activeCategory}</b><br/>
            Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø¯Ù‡ Ù„Ø³Ù‡.
          </div>
        `;
        renderCart();
        return;
      }

      shopGrid.innerHTML = items.map(p=>`
        <div class="card">
          <h3>${esc(p.title)}</h3>
          <p>${esc(p.desc)}</p>
          <div class="meta">
            <span class="tag">${Number(p.price)||0} EGP</span>
            <span class="tag">Seller: @${esc(p.seller || "â€”")}</span>
          </div>
          <div class="actions" style="margin-top:12px">
            <button class="btn primary" data-buy="${esc(p.id)}">Ø´Ø±Ø§Ø¡</button>
            <button class="btn ok" data-add="${esc(p.id)}">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
          </div>
        </div>
      `).join("");

      shopGrid.querySelectorAll("[data-add]").forEach(btn=>{
        btn.onclick=()=>{
          const id = btn.dataset.add;
          const prod = loadSupplies().find(x=>x.id===id);
          if(!prod) return;
          addToCart({ id: prod.id, title: prod.title, price: Number(prod.price)||0, seller: prod.seller||"", category: prod.category });
          alert("âœ… Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø©");
        };
      });

      shopGrid.querySelectorAll("[data-buy]").forEach(btn=>{
        btn.onclick=()=>{
          const id = btn.dataset.buy;
          const prod = loadSupplies().find(x=>x.id===id);
          if(!prod) return;
          addToCart({ id: prod.id, title: prod.title, price: Number(prod.price)||0, seller: prod.seller||"", category: prod.category });
          checkoutBox.classList.remove("hidden");
          window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
        };
      });

      renderCart();
    }

    clearCartBtn.onclick = ()=>{
      saveCart([]);
      renderCart();
      coNote.textContent = "";
    };
    checkoutBtn.onclick = ()=>{
      checkoutBox.classList.toggle("hidden");
      coNote.textContent = "";
    };

    confirmOrderBtn.onclick = ()=>{
      const name = (coName.value||"").trim();
      const contact = (coContact.value||"").trim();
      const pay = coPay.value;

      const cart = loadCart();
      if(!cart.length){
        coNote.textContent = "âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.";
        return;
      }
      if(!name || !contact){
        coNote.textContent = "âŒ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„.";
        return;
      }
      if(!pay){
        coNote.textContent = "âŒ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù‚ÙÙˆÙ„Ø©.";
        return;
      }

      const total = cartTotalEGP(cart);
      const details = cart.map(x=>`${x.title} x${x.qty}`).join(" | ");

      // assign seller: Ù„Ùˆ Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ => seller Ø¨ØªØ§Ø¹Ù‡ØŒ Ù„Ùˆ Ø§ÙƒØªØ± => mixed
      let seller = cart.length === 1 ? (cart[0].seller||"") : "mixed";

      const orders = loadOrders();
      orders.unshift({
        id: Date.now().toString(),
        at: new Date().toISOString(),
        customer: name,
        contact: contact,
        seller: seller,
        details: `${details} | Pay:${pay} | Total:${total} EGP`,
        status: "open"
      });
      saveOrders(orders);

      saveCart([]);
      renderCart();

      coName.value = "";
      coContact.value = "";
      coNote.textContent = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨! Ù‡ÙŠØªØ´Ø§Ù Ù„Ù„Ø¨Ø§Ø¦Ø¹/Ø§Ù„Ø£ÙˆÙ†Ø± Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.";
    };

    // ===== Support -> Issues =====
    const issueForm = document.getElementById("issueForm");
    const issueNote = document.getElementById("issueNote");

    issueForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const fd = new FormData(issueForm);
      const issue = {
        id: uid("i"),
        at: new Date().toISOString(),
        name: String(fd.get("name")||"").trim(),
        contact: String(fd.get("contact")||"").trim(),
        type: String(fd.get("type")||"").trim(),
        details: String(fd.get("details")||"").trim(),
        status: "open",
        replies: []
      };
      const all = loadIssues();
      all.unshift(issue);
      saveIssues(all);

      issueNote.textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.";
      issueForm.reset();
      setTimeout(()=> issueNote.textContent = "", 3500);
    });

    // ===== Seller Panel =====
    const sellerOrdersList = document.getElementById("sellerOrdersList");
    const sellerOrdersChip = document.getElementById("sellerOrdersChip");

    function statusHTML(s){
      if (s==="open") return `<span class="status s-open">open</span>`;
      if (s==="done") return `<span class="status s-done">done</span>`;
      return `<span class="status s-closed">closed</span>`;
    }

    function renderSellerOrders(){
      const s = getSession();
      const role = (s && s.me) ? s.role : "public";
      if(role !== "seller" && role !== "owner"){
        sellerOrdersList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        sellerOrdersChip.textContent = "â€”";
        return;
      }

      // seller username Ù„Ù„ÙÙ„ØªØ±Ø©: Ù‡Ù†Ø®Ù„ÙŠÙ‡Ø§ username Ø¨ØªØ§Ø¹ Discord ÙƒÙ€ fallback
      const myName = s?.me?.username || "";
      const orders = loadOrders();

      // seller ÙŠØ´ÙˆÙ Ø§Ù„Ù„ÙŠ seller==username Ø£Ùˆ mixed (Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ). Ù‡Ù†Ø§ Ù‡Ù†Ø´ÙˆÙ seller==username ÙÙ‚Ø·:
      const mine = orders.filter(o => (o.seller||"").toLowerCase() === myName.toLowerCase());

      sellerOrdersChip.textContent = `Ø¹Ø¯Ø¯: ${mine.length}`;

      sellerOrdersList.innerHTML = mine.length ? mine.map(o=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(o.details)}</div>
            ${statusHTML(o.status)}
          </div>
          <div class="small" style="margin-top:6px">
            Ø§Ù„Ø¹Ù…ÙŠÙ„: <b style="color:var(--text)">${esc(o.customer)}</b> â€”
            ØªÙˆØ§ØµÙ„: <b style="color:var(--text)">${esc(o.contact)}</b><br/>
            ÙˆÙ‚Øª: ${new Date(o.at).toLocaleString()}
          </div>
          <div class="actions">
            <button class="btn ok small" data-seller-contact="${esc(o.contact)}">ØªÙˆØ§ØµÙ„</button>
            <button class="btn primary small" data-seller-done="${o.id}">done</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Orders Ù„Ùƒ.</div>`;

      // ØªÙˆØ§ØµÙ„ (ÙŠÙØªØ­ DM Ù„Ùˆ ÙƒØ§Ù† contact = userId Ø£Ùˆ username) â€” Ù‡Ù†ÙØªØ­ Discord app ÙƒÙ€ best-effort:
      sellerOrdersList.querySelectorAll("[data-seller-contact]").forEach(b=>{
        b.onclick=()=>{
          const contact = b.dataset.sellerContact || "";
          // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ø·Ø· ID: Ø§ÙØªØ­ user profile
          if(/^\d{10,30}$/.test(contact.trim())){
            window.open(`https://discord.com/users/${contact.trim()}`, "_blank");
            return;
          }
          alert("Ø­Ø· Discord ID ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø´Ø§Ù† ÙØªØ­ DM ÙŠØ¨Ù‚Ù‰ Ù…Ø¨Ø§Ø´Ø± âœ…");
        };
      });

      // done => Ù†Ù†Ù‚Ù„ Ù„Ù„Ù€ proofs
      sellerOrdersList.querySelectorAll("[data-seller-done]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.sellerDone;
          const orders2 = loadOrders();
          const it = orders2.find(x=>x.id===id);
          if(!it) return;
          it.status = "done";
          saveOrders(orders2);

          const proofs = loadProofs();
          proofs.unshift({ ...it, movedAt: new Date().toISOString() });
          saveProofs(proofs);

          // optional: remove from orders after done
          const filtered = orders2.filter(x=>x.id!==id);
          saveOrders(filtered);

          renderAll();
        };
      });
    }

    // Seller supplies pending
    const sellerSupCategory = document.getElementById("sellerSupCategory");
    const sellerSupTitle = document.getElementById("sellerSupTitle");
    const sellerSupPrice = document.getElementById("sellerSupPrice");
    const sellerSupDesc = document.getElementById("sellerSupDesc");
    const sellerSupplyForm = document.getElementById("sellerSupplyForm");
    const sellerSupNote = document.getElementById("sellerSupNote");
    const sellerPendingList = document.getElementById("sellerPendingList");

    function fillCategorySelect(sel){
      sel.innerHTML = CATEGORIES.map(c=> `<option value="${c}">${c}</option>`).join("");
    }

    function renderSellerPending(){
      const s = getSession();
      const role = (s && s.me) ? s.role : "public";
      if(role !== "seller" && role !== "owner"){
        sellerPendingList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        return;
      }
      const myName = s?.me?.username || "";
      const pend = loadPendingSupplies().filter(x=> (x.by||"").toLowerCase() === myName.toLowerCase());
      sellerPendingList.innerHTML = pend.length ? pend.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="small">(${esc(p.category)})</span></div>
            <span class="status s-open">pending</span>
          </div>
          <div class="small" style="margin-top:6px">
            Price: <b style="color:var(--text)">${Number(p.price)||0} EGP</b><br/>
            ${esc(p.desc)}
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Pending.</div>`;
    }

    sellerSupplyForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const s = getSession();
      if(!s || !s.me || (s.role !== "seller" && s.role !== "owner")){
        sellerSupNote.textContent = "âŒ Ù„Ø§Ø²Ù… ØªØ¨Ù‚Ù‰ Seller.";
        return;
      }

      const cat = sellerSupCategory.value;
      const title = (sellerSupTitle.value||"").trim();
      const price = Number(sellerSupPrice.value||0);
      const desc = (sellerSupDesc.value||"").trim();
      const by = s.me.username;

      if(!CATEGORIES.includes(cat) || !title || !price || !desc){
        sellerSupNote.textContent = "âŒ Ø§Ù…Ù„Ø§ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
        return;
      }

      const pend = loadPendingSupplies();
      pend.unshift({ id: uid("pend"), at: new Date().toISOString(), category: cat, title, price, desc, by });
      savePendingSupplies(pend);

      sellerSupTitle.value=""; sellerSupPrice.value=""; sellerSupDesc.value="";
      sellerSupNote.textContent = "âœ… Ø§ØªØ¨Ø¹Øª Ù„Ù„Ø£ÙˆÙ†Ø± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©.";
      setTimeout(()=> sellerSupNote.textContent="", 2500);

      renderAll();
    });

    // ===== Owner Panel =====
    const ownSupCategory = document.getElementById("ownSupCategory");
    const ownSupTitle = document.getElementById("ownSupTitle");
    const ownSupPrice = document.getElementById("ownSupPrice");
    const ownSupSeller = document.getElementById("ownSupSeller");
    const ownSupDesc = document.getElementById("ownSupDesc");
    const ownAddSupplyBtn = document.getElementById("ownAddSupplyBtn");
    const ownSupNote = document.getElementById("ownSupNote");
    const ownerPendingList = document.getElementById("ownerPendingList");
    const ownerSuppliesList = document.getElementById("ownerSuppliesList");
    const ownerSupChip = document.getElementById("ownerSupChip");

    function isOwner(){
      const s = getSession();
      return !!(s && s.me && s.role === "owner");
    }

    function renderOwnerSupplies(){
      if(!isOwner()){
        ownerPendingList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        ownerSuppliesList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        ownerSupChip.textContent = "â€”";
        return;
      }

      const approved = loadSupplies();
      const pend = loadPendingSupplies();

      ownerSupChip.textContent = `Approved: ${approved.length} â€” Pending: ${pend.length}`;

      ownerPendingList.innerHTML = pend.length ? pend.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="small">(${esc(p.category)})</span></div>
            <span class="status s-open">pending</span>
          </div>
          <div class="small" style="margin-top:6px">
            By: <b style="color:var(--text)">@${esc(p.by||"")}</b><br/>
            Price: <b style="color:var(--text)">${Number(p.price)||0} EGP</b><br/>
            ${esc(p.desc)}
          </div>
          <div class="actions">
            <button class="btn ok small" data-approve="${p.id}">Approve</button>
            <button class="btn danger small" data-reject="${p.id}">Reject</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Pending.</div>`;

      ownerSuppliesList.innerHTML = approved.length ? approved.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="small">(${esc(p.category)})</span></div>
            <span class="status s-done">${Number(p.price)||0} EGP</span>
          </div>
          <div class="small" style="margin-top:6px">
            Seller: <b style="color:var(--text)">@${esc(p.seller||"â€”")}</b><br/>
            ${esc(p.desc)}
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-sup="${p.id}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Supplies.</div>`;

      ownerPendingList.querySelectorAll("[data-approve]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.approve;
          const pend2 = loadPendingSupplies();
          const it = pend2.find(x=>x.id===id);
          if(!it) return;

          const approved2 = loadSupplies();
          approved2.unshift({
            id: uid("p"),
            at: new Date().toISOString(),
            category: it.category,
            title: it.title,
            price: it.price,
            seller: it.by || "",
            desc: it.desc
          });
          saveSupplies(approved2);

          const filtered = pend2.filter(x=>x.id!==id);
          savePendingSupplies(filtered);

          renderAll();
        };
      });

      ownerPendingList.querySelectorAll("[data-reject]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.reject;
          const pend2 = loadPendingSupplies().filter(x=>x.id!==id);
          savePendingSupplies(pend2);
          renderAll();
        };
      });

      ownerSuppliesList.querySelectorAll("[data-del-sup]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.delSup;
          const approved2 = loadSupplies().filter(x=>x.id!==id);
          saveSupplies(approved2);
          renderAll();
        };
      });
    }

    ownAddSupplyBtn.onclick = ()=>{
      if(!isOwner()){
        ownSupNote.textContent = "âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.";
        return;
      }
      const cat = ownSupCategory.value;
      const title = (ownSupTitle.value||"").trim();
      const price = Number(ownSupPrice.value||0);
      const seller = (ownSupSeller.value||"").trim().replace(/^@/,"");
      const desc = (ownSupDesc.value||"").trim();

      if(!CATEGORIES.includes(cat) || !title || !price || !desc){
        ownSupNote.textContent = "âŒ Ø§Ù…Ù„Ø§ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
        return;
      }

      const approved = loadSupplies();
      approved.unshift({ id: uid("p"), at:new Date().toISOString(), category:cat, title, price, seller, desc });
      saveSupplies(approved);

      ownSupTitle.value=""; ownSupPrice.value=""; ownSupSeller.value=""; ownSupDesc.value="";
      ownSupNote.textContent = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬.";
      setTimeout(()=> ownSupNote.textContent="", 2500);

      renderAll();
    };

    // Owner members
    const addSellerIdInput = document.getElementById("addSellerIdInput");
    const addSellerIdBtn = document.getElementById("addSellerIdBtn");
    const sellerIdsList = document.getElementById("sellerIdsList");

    const addOwnerIdInput = document.getElementById("addOwnerIdInput");
    const addOwnerIdBtn = document.getElementById("addOwnerIdBtn");
    const ownerIdsList = document.getElementById("ownerIdsList");

    function renderMembers(){
      if(!isOwner()){
        sellerIdsList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        ownerIdsList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        return;
      }
      const sellersIds = safeJSONParse(localStorage.getItem(KEY_SELLERS_IDS) || "[]", []);
      const ownersIds = safeJSONParse(localStorage.getItem(KEY_OWNERS) || "[]", []);

      sellerIdsList.innerHTML = sellersIds.length ? sellersIds.map(id=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(id)}</div>
            <span class="status s-done">seller id</span>
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-sellerid="${esc(id)}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Sellers IDs.</div>`;

      ownerIdsList.innerHTML = ownersIds.length ? ownersIds.map(id=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(id)}</div>
            <span class="status s-done">owner id</span>
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-ownerid="${esc(id)}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Owners IDs.</div>`;

      sellerIdsList.querySelectorAll("[data-del-sellerid]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.delSellerid;
          const arr = safeJSONParse(localStorage.getItem(KEY_SELLERS_IDS) || "[]", []).filter(x=>x!==id);
          localStorage.setItem(KEY_SELLERS_IDS, JSON.stringify(arr));
          renderAll();
        };
      });

      ownerIdsList.querySelectorAll("[data-del-ownerid]").forEach(b=>{
        b.onclick=()=>{
          const id = b.dataset.delOwnerid;
          const arr = safeJSONParse(localStorage.getItem(KEY_OWNERS) || "[]", []).filter(x=>x!==id);
          localStorage.setItem(KEY_OWNERS, JSON.stringify(arr));
          renderAll();
        };
      });
    }

    addSellerIdBtn.onclick = ()=>{
      if(!isOwner()) return;
      const id = (addSellerIdInput.value||"").trim();
      if(!/^\d{10,30}$/.test(id)) return alert("Ø­Ø· Discord ID ØµØ­ÙŠØ­");
      const arr = safeJSONParse(localStorage.getItem(KEY_SELLERS_IDS) || "[]", []);
      if(!arr.includes(id)) arr.unshift(id);
      localStorage.setItem(KEY_SELLERS_IDS, JSON.stringify(arr));
      addSellerIdInput.value="";
      renderAll();
    };

    addOwnerIdBtn.onclick = ()=>{
      if(!isOwner()) return;
      const id = (addOwnerIdInput.value||"").trim();
      if(!/^\d{10,30}$/.test(id)) return alert("Ø­Ø· Discord ID ØµØ­ÙŠØ­");
      const arr = safeJSONParse(localStorage.getItem(KEY_OWNERS) || "[]", []);
      if(!arr.includes(id)) arr.unshift(id);
      localStorage.setItem(KEY_OWNERS, JSON.stringify(arr));
      addOwnerIdInput.value="";
      renderAll();
    };

    // Owner issues
    const issuesList = document.getElementById("issuesList");
    const issuesChip = document.getElementById("issuesChip");

    function renderIssues(){
      if(!isOwner()){
        issuesList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        issuesChip.textContent = "â€”";
        return;
      }
      const list = loadIssues();
      issuesChip.textContent = `Ø¹Ø¯Ø¯: ${list.length}`;

      issuesList.innerHTML = list.length ? list.map(i=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">Issue: ${esc(i.type)}</div>
            ${statusHTML(i.status)}
          </div>
          <div class="small" style="margin-top:6px">
            Ù…Ù†: <b style="color:var(--text)">${esc(i.name)}</b> â€”
            ØªÙˆØ§ØµÙ„: <b style="color:var(--text)">${esc(i.contact)}</b><br/>
            ÙˆÙ‚Øª: ${new Date(i.at).toLocaleString()}<br/>
            Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${esc(i.details)}
          </div>

          ${(Array.isArray(i.replies) && i.replies.length) ? `
            <div class="small" style="margin-top:10px">
              <b style="color:var(--text)">Ø¢Ø®Ø± Ø±Ø¯:</b> ${esc(i.replies[0].msg)}<br/>
              <span style="opacity:.85">${new Date(i.replies[0].at).toLocaleString()}</span>
            </div>
          ` : ""}

          <div class="actions">
            <button class="btn primary small" data-reply="${i.id}">Ø±Ø¯</button>
            <button class="btn ok small" data-i-set="done" data-iid="${i.id}">done</button>
            <button class="btn danger small" data-i-set="closed" data-iid="${i.id}">closed</button>
            <button class="btn small" data-i-del="${i.id}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Issues.</div>`;

      issuesList.querySelectorAll("[data-i-set]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-iid");
          const st = btn.getAttribute("data-i-set");
          const arr = loadIssues();
          const it = arr.find(x=>x.id===id);
          if (it){ it.status = st; saveIssues(arr); renderAll(); }
        });
      });

      issuesList.querySelectorAll("[data-i-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-i-del");
          const arr = loadIssues().filter(x=>x.id!==id);
          saveIssues(arr);
          renderAll();
        });
      });

      issuesList.querySelectorAll("[data-reply]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-reply");
          const msg = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰:");
          if (!msg) return;

          const arr = loadIssues();
          const it = arr.find(x=>x.id===id);
          if (!it) return;

          if (!Array.isArray(it.replies)) it.replies = [];
          it.replies.unshift({ at: new Date().toISOString(), msg: msg.trim() });
          it.status = "done";
          saveIssues(arr);

          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø¯.");
          renderAll();
        });
      });
    }

    // Owner payments status
    const paymentsAdminList = document.getElementById("paymentsAdminList");
    function renderPaymentsAdmin(){
      if(!isOwner()){
        paymentsAdminList.innerHTML = `<div class="small">Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©.</div>`;
        return;
      }
      const cfg = loadPaymentsCfg();
      paymentsAdminList.innerHTML = PAYMENT_METHODS.map(m=>{
        const on = cfg[m.key] !== false;
        return `
          <div class="item">
            <div class="itemTop">
              <div class="itemTitle">${esc(m.label)}</div>
              <span class="status ${on ? "s-done" : "s-closed"}">${on ? "enabled" : "disabled"}</span>
            </div>
            <div class="actions">
              <button class="btn ${on ? "danger" : "ok"} small" data-pay-toggle="${m.key}">
                ${on ? "Disable" : "Enable"}
              </button>
            </div>
          </div>
        `;
      }).join("");

      paymentsAdminList.querySelectorAll("[data-pay-toggle]").forEach(b=>{
        b.onclick=()=>{
          const key = b.dataset.payToggle;
          const cfg2 = loadPaymentsCfg();
          cfg2[key] = !(cfg2[key] !== false); // toggle
          savePaymentsCfg(cfg2);
          renderAll();
        };
      });
    }

    // ===== Category selects =====
    fillCategorySelect(sellerSupCategory);
    fillCategorySelect(ownSupCategory);

    // ===== Render All =====
    function renderAll(){
      renderLoginStatus();
      buildNav();

      renderSellers();
      renderPayments();
      renderShop();
      renderProofs();

      renderSellerOrders();
      renderSellerPending();

      renderOwnerSupplies();
      renderMembers();
      renderIssues();
      renderPaymentsAdmin();
    }

    // ===== Initial route =====
    function routeInit(){
      const hash = (location.hash || "#about").replace("#","");
      if(pages[hash]) setActivePage(hash);
      else setActivePage("about");
    }

    // ===== storage sync =====
    window.addEventListener("storage", ()=> renderAll());

    // ===== init =====
    renderAll();
    routeInit();
  </script>
</body>
</html>
