<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voxa â€” Multi Panel</title>

  <style>
    :root{
      --bg:#0b1220; --panel:#0c162b; --text:#eaf0ff; --muted:#a9b7d7;
      --brand:#4aa3ff; --ok:#29d17d; --danger:#ff5c7a; --warn:#ffcc66;
      --border:rgba(255,255,255,.08); --radius:18px; --shadow:0 18px 50px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(74,163,255,.25), transparent 60%),
        radial-gradient(900px 500px at 20% 0%, rgba(41,209,125,.16), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    .app{display:grid;grid-template-columns:320px 1fr;min-height:100vh}
    aside{
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 40%), var(--panel);
      padding:18px;
      border-left:1px solid var(--border);
      position:sticky; top:0; height:100vh;
    }
    main{padding:24px 24px 40px}

    @media (max-width:980px){
      .app{grid-template-columns:1fr}
      aside{position:fixed; inset:0; width:min(92vw,360px); height:auto;
        transform: translateX(110%); transition:.25s ease; z-index:50;
        border-left:none; border-right:1px solid var(--border);
      }
      aside.open{transform: translateX(0)}
      .overlay{position:fixed; inset:0; background: rgba(0,0,0,.55); z-index:40;
        opacity:0; pointer-events:none; transition:.2s ease;
      }
      .overlay.show{opacity:1; pointer-events:auto}
      main{padding:18px 16px 30px}
      .topbar{display:flex}
    }

    .topbar{
      display:none;
      position:sticky; top:0; z-index:10; padding:14px 16px;
      background: rgba(11,18,32,.7); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      gap:10px; align-items:center; justify-content:space-between;
    }
    .burger{border:1px solid var(--border); background: rgba(255,255,255,.04); color:var(--text);
      border-radius:14px; padding:10px 12px; cursor:pointer; font-weight:900;
    }
    .overlay{display:block}

    .logo{
      display:flex; gap:12px; align-items:center; padding:14px;
      border:1px solid var(--border); border-radius: var(--radius);
      background: rgba(255,255,255,.04); box-shadow: var(--shadow);
    }
    .badge{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, rgba(74,163,255,.9), rgba(41,209,125,.7));
      display:grid; place-items:center; font-weight:900;
    }
    .logo h1{margin:0; font-size:16px}
    .logo p{margin:3px 0 0; color:var(--muted); font-size:12px; line-height:1.6}

    nav{margin-top:16px; display:flex; flex-direction:column; gap:10px}
    .navbtn{
      display:flex; gap:10px; align-items:center; width:100%;
      padding:12px 14px; border-radius:16px; border:1px solid var(--border);
      background: rgba(255,255,255,.03); color:var(--text); cursor:pointer; text-align:right;
      transition:.15s ease;
    }
    .navbtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.06)}
    .navbtn.active{background: rgba(74,163,255,.14); border-color: rgba(74,163,255,.35)}
    .navicon{
      width:34px; height:34px; border-radius:12px; background: rgba(255,255,255,.06);
      display:grid; place-items:center; border:1px solid var(--border); flex:0 0 auto;
    }
    .navtext .t{font-weight:900}
    .navtext .d{font-size:12px; color:var(--muted); margin-top:2px}

    .sidecard{
      margin-top:14px; padding:14px; border-radius: var(--radius);
      border:1px solid var(--border); background: rgba(255,255,255,.03);
    }
    .small{color:var(--muted); font-size:12px; line-height:1.7}
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; align-items:center}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:999px; border:1px solid var(--border);
      background: rgba(255,255,255,.03); color:var(--muted); font-size:12px;
    }

    .pagehead{display:flex; justify-content:space-between; align-items:flex-start; gap:16px; margin-bottom:14px}
    .pagehead h2{margin:0; font-size:24px}
    .pagehead p{margin:6px 0 0; color:var(--muted); line-height:1.8; max-width:70ch}
    .chiprow{display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end}
    .chip{font-size:12px; padding:7px 10px; border-radius:999px; border:1px solid var(--border);
      background: rgba(255,255,255,.03); color:var(--muted);
    }

    .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin-top:16px}
    .card{
      grid-column: span 6; padding:16px; border-radius: var(--radius); border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow); min-height:120px;
    }
    .card.full{grid-column:span 12}
    .card h3{margin:0 0 8px; font-size:16px}
    .card p{margin:0; color:var(--muted); line-height:1.8}

    .meta{margin-top:12px; display:flex; gap:8px; flex-wrap:wrap}
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background: rgba(255,255,255,.03); color:var(--muted)}
    .tag.ok{color:var(--ok); border-color: rgba(41,209,125,.35); background: rgba(41,209,125,.10)}
    .tag.warn{color:var(--warn); border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.10)}
    .tag.danger{color:var(--danger); border-color: rgba(255,92,122,.35); background: rgba(255,92,122,.10)}

    @media (max-width:980px){
      .card{grid-column: span 12}
      .pagehead{flex-direction:column; align-items:flex-start}
      .chiprow{justify-content:flex-start}
    }

    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:14px}
    .tab{
      border:1px solid var(--border); background: rgba(255,255,255,.03); color:var(--text);
      padding:8px 10px; border-radius:999px; font-weight:900; cursor:pointer; font-size:12px;
    }
    .tab.active{border-color: rgba(74,163,255,.45); background: rgba(74,163,255,.16)}

    .emptybox{
      grid-column: span 12; padding:18px; border-radius: var(--radius);
      border:1px dashed rgba(255,255,255,.18); background: rgba(255,255,255,.02);
      color: var(--muted); line-height:1.9;
    }

    form{
      margin-top:12px; max-width: 920px; border:1px solid var(--border);
      border-radius: var(--radius); background: rgba(255,255,255,.03);
      padding:16px; box-shadow: var(--shadow);
    }
    .fgrid{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width:980px){ .fgrid{grid-template-columns:1fr} }
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input, textarea, select{
      width:100%; border-radius: 14px; border:1px solid var(--border);
      background: rgba(0,0,0,.18); padding:10px 12px; color:var(--text);
      outline:none; font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}

    .btn{
      cursor:pointer; border:1px solid var(--border); background: rgba(255,255,255,.04);
      color:var(--text); padding:10px 12px; border-radius:14px; font-weight:900;
    }
    .btn.primary{border-color: rgba(74,163,255,.45); background: rgba(74,163,255,.16)}
    .btn.ok{border-color: rgba(41,209,125,.45); background: rgba(41,209,125,.14)}
    .btn.danger{border-color: rgba(255,92,122,.45); background: rgba(255,92,122,.14)}
    .btn.small{padding:8px 10px; border-radius:12px; font-weight:800}

    /* Lists */
    .list{display:flex; flex-direction:column; gap:10px; margin-top:10px}
    .item{
      border:1px solid var(--border); background: rgba(255,255,255,.03);
      border-radius:16px; padding:12px;
    }
    .itemTop{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .itemTitle{font-weight:900}
    .hr{height:1px;background: var(--border);margin:12px 0}
    .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    @media (max-width:520px){ .actions .btn{flex:1 1 auto} }

    .status{
      font-weight:900;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);font-size:12px;
    }
    .s-open{color:var(--warn)}
    .s-done{color:var(--ok)}
    .s-closed{color:var(--danger)}
    .hidden{display:none !important}

    /* Cart */
    .cartItem{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:10px}
    .total{font-weight:900}
    .checkoutBox{display:none;margin-top:14px}

    section.page{display:none}
    section.page.active{display:block}

    /* Modal */
    .modalWrap{
      position:fixed; inset:0; display:none; place-items:center;
      background: rgba(0,0,0,.55); z-index:100;
      padding:16px;
    }
    .modalWrap.show{display:grid}
    .modal{
      width:min(680px, 100%);
      border:1px solid var(--border);
      border-radius:22px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding:16px;
    }
    .modalHead{display:flex; justify-content:space-between; gap:10px; align-items:center; flex-wrap:wrap}
    .modalHead h3{margin:0}
    .xbtn{border:1px solid var(--border); background: rgba(255,255,255,.04); color:var(--text);
      border-radius:12px; padding:8px 10px; cursor:pointer; font-weight:900;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <button class="burger" id="openMenu">â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    <div style="font-weight:900">Voxa</div>
    <button class="btn small primary" id="openLogin">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
  </div>
  <div class="overlay" id="overlay"></div>

  <!-- Login Modal -->
  <div class="modalWrap" id="loginModal">
    <div class="modal">
      <div class="modalHead">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±ØªØ¨</h3>
        <button class="xbtn" id="closeLogin">âœ–</button>
      </div>
      <div class="hr"></div>

      <div class="fgrid">
        <div>
          <label>Ø§Ù„Ø±ØªØ¨Ø©</label>
          <select id="loginRole">
            <option value="seller">Seller (Ø¨Ø§Ø¦Ø¹)</option>
            <option value="owner">Owner (Ù…Ø³Ø¤ÙˆÙ„)</option>
          </select>
        </div>
        <div>
          <label>Ø§Ù„ÙƒÙˆØ¯</label>
          <input id="loginCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" />
        </div>
      </div>

      <div id="sellerBox" style="margin-top:12px">
        <label>ÙŠÙˆØ²Ø± Ø§Ù„Ø¨Ø§Ø¦Ø¹ (Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…Ø¶Ø§Ù ÙÙŠ Members)</label>
        <input id="sellerUser" placeholder="Ù…Ø«Ø§Ù„: gq_8" />
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn ok" id="doLogin">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" id="doLogout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>

      <div class="muted" id="loginNote" style="margin-top:10px"></div>

      <div class="hr"></div>
      <div class="muted">
        <b>Seller Code Ø«Ø§Ø¨Øª:</b> 20119<br/>
        <b>Owner Key:</b> Ø§Ù†Øª Ø§Ù„Ù„ÙŠ Ø¨ØªØ­Ø·Ù‡ Ù…Ù† Owner Panel â†’ Members (Ø£ÙˆÙ„ Ù…Ø±Ø© Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù„Ù‡ Setup).<br/>
      </div>
    </div>
  </div>

  <div class="app">
    <aside id="sidebar">
      <div class="logo">
        <div class="badge">VX</div>
        <div>
          <h1>Voxa</h1>
          <p>Public + Seller + Owner</p>
        </div>
      </div>

      <div class="sidecard">
        <div class="small">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</div>
        <div class="pillrow">
          <span class="pill" id="rolePill">Role: public</span>
          <span class="pill hidden" id="sellerPill">Seller: â€”</span>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn small primary" id="openLogin2">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
          <button class="btn small danger" id="logout2">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <!-- NAV: Public -->
      <nav id="navPublic">
        <button class="navbtn active" data-page="about">
          <div class="navicon">â„¹ï¸</div>
          <div class="navtext"><div class="t">About us</div><div class="d">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div></div>
        </button>
        <button class="navbtn" data-page="shop">
          <div class="navicon">ğŸ›’</div>
          <div class="navtext"><div class="t">Shop</div><div class="d">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª + Ø§Ù„Ø³Ù„Ø©</div></div>
        </button>
        <button class="navbtn" data-page="sellers">
          <div class="navicon">ğŸ‘¤</div>
          <div class="navtext"><div class="t">Sellers</div><div class="d">Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†</div></div>
        </button>
        <button class="navbtn" data-page="proofs">
          <div class="navicon">âœ…</div>
          <div class="navtext"><div class="t">Proofs</div><div class="d">Ø¥Ø«Ø¨Ø§ØªØ§Øª</div></div>
        </button>
        <button class="navbtn" data-page="payments">
          <div class="navicon">ğŸ’³</div>
          <div class="navtext"><div class="t">Payments</div><div class="d">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</div></div>
        </button>
        <button class="navbtn" data-page="support">
          <div class="navicon">ğŸ› ï¸</div>
          <div class="navtext"><div class="t">Support</div><div class="d">Ø´ÙƒØ§ÙˆÙŠ</div></div>
        </button>
      </nav>

      <!-- NAV: Seller -->
      <nav id="navSeller" class="hidden">
        <button class="navbtn" data-page="seller-orders">
          <div class="navicon">ğŸ“¦</div>
          <div class="navtext"><div class="t">Orders</div><div class="d">Ø·Ù„Ø¨Ø§ØªÙƒ ÙÙ‚Ø·</div></div>
        </button>
        <button class="navbtn" data-page="seller-supplies">
          <div class="navicon">â•</div>
          <div class="navtext"><div class="t">Supplies</div><div class="d">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª</div></div>
        </button>
      </nav>

      <!-- NAV: Owner -->
      <nav id="navOwner" class="hidden">
        <button class="navbtn" data-page="owner-supplies">
          <div class="navicon">ğŸ“¦</div>
          <div class="navtext"><div class="t">Supplies</div><div class="d">Approve/Manage</div></div>
        </button>
        <button class="navbtn" data-page="owner-members">
          <div class="navicon">ğŸ‘¥</div>
          <div class="navtext"><div class="t">Members</div><div class="d">Sellers + Owners</div></div>
        </button>
        <button class="navbtn" data-page="owner-issues">
          <div class="navicon">ğŸ§¾</div>
          <div class="navtext"><div class="t">Issues</div><div class="d">Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</div></div>
        </button>
        <button class="navbtn" data-page="owner-payments">
          <div class="navicon">ğŸ’³</div>
          <div class="navtext"><div class="t">Payments Status</div><div class="d">ØªÙØ¹ÙŠÙ„/Ù‚ÙÙ„</div></div>
        </button>
      </nav>

      <div class="sidecard">
        <div class="small">
          <b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> Owner Key Ø¨ÙŠØªØ­Ø· Ù…Ù† Owner Panel â†’ Members.
        </div>
      </div>
    </aside>

    <main>
      <!-- ============== PUBLIC PAGES ============== -->

      <section class="page active" id="page-about">
        <div class="pagehead">
          <div>
            <h2>About us</h2>
            <p>Voxa Store â€” Public + Seller + Owner system.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="whoChip">Role: public</span>
          </div>
        </div>

        <div class="grid">
          <div class="card">
            <h3>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</h3>
            <p>Ø¹Ù†Ø¯Ùƒ 3 Panels: Public / Seller / Owner.</p>
            <div class="meta">
              <span class="tag ok">Public</span>
              <span class="tag warn">Seller</span>
              <span class="tag danger">Owner</span>
            </div>
          </div>

          <div class="card">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <p>Seller Ø¨ÙƒÙˆØ¯ 20119 + ÙŠÙˆØ²Ø± Ø¨Ø§Ø¦Ø¹. Owner Ø¨ÙƒÙˆØ¯ Ø§Ù†Øª Ø¨ØªØ­Ø·Ù‡.</p>
          </div>
        </div>
      </section>

      <section class="page" id="page-shop">
        <div class="pagehead">
          <div>
            <h2>Shop</h2>
            <p>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© (Approved) ÙÙ‚Ø· Ù‡ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ØªØ¸Ù‡Ø± Ù‡Ù†Ø§.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="shopCountChip">â€¦</span>
          </div>
        </div>

        <div class="tabs" id="categoryTabs"></div>
        <div class="grid" id="shopGrid"></div>

        <div class="grid">
          <div class="card full">
            <h3>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h3>
            <div id="cartList" style="margin-top:10px;color:var(--muted)">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.</div>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;align-items:center">
              <span class="total" id="cartTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 EGP</span>
              <button class="btn ok" id="checkoutBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
              <button class="btn small" id="clearCartBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
            </div>

            <div class="checkoutBox" id="checkoutBox">
              <div class="card full" style="background:rgba(0,0,0,.15); margin-top:14px">
                <h3>ğŸ§¾ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</h3>

                <div class="fgrid" style="margin-top:12px">
                  <div>
                    <label>Ø§Ø³Ù…Ùƒ</label>
                    <input id="coName" placeholder="Ø§Ø³Ù…Ùƒ" />
                  </div>
                  <div>
                    <label>ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„</label>
                    <input id="coContact" placeholder="Discord ID / Username / Ø±Ø§Ø¨Ø·..." />
                  </div>
                </div>

                <div style="margin-top:12px">
                  <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                  <select id="coPay"></select>
                </div>

                <button class="btn primary" id="confirmOrderBtn" style="margin-top:12px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
                <p id="coNote" style="margin-top:10px;color:var(--muted)"></p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="page" id="page-sellers">
        <div class="pagehead">
          <div>
            <h2>Sellers</h2>
            <p>Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† (Ø¨ÙŠØªØ­Ø¯Ø¯ÙˆØ§ Ù…Ù† Owner Panel â†’ Members).</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="sellersCountChip">â€¦</span>
          </div>
        </div>
        <div class="grid" id="sellersGrid"></div>
      </section>

      <section class="page" id="page-proofs">
        <div class="pagehead">
          <div>
            <h2>Proofs</h2>
            <p>Ø·Ù„Ø¨Ø§Øª Ø§ØªØ¹Ù…Ù„Ù‡Ø§ Done (Ø¨Ø¯ÙˆÙ† Ø£Ø²Ø±Ø§Ø±).</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="proofsCountChip">â€¦</span>
          </div>
        </div>
        <div class="grid" id="proofsGrid"></div>
      </section>

      <section class="page" id="page-payments">
        <div class="pagehead">
          <div>
            <h2>Payments</h2>
            <p>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø© (Ø¨ØªØªØ­Ø¯Ø¯ Ù…Ù† Owner Panel â†’ Payments Status).</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="payCountChip">â€¦</span>
          </div>
        </div>
        <div class="grid" id="paymentsGrid"></div>
      </section>

      <section class="page" id="page-support">
        <div class="pagehead">
          <div>
            <h2>Support</h2>
            <p>Ù‚Ø¯Ù‘Ù… Ù…Ø´ÙƒÙ„Ø©ØŒ Ù‡ØªØ¸Ù‡Ø± Ù„Ù„Ø£ÙˆÙ†Ø±Ø§Øª ÙÙŠ Issues.</p>
          </div>
          <div class="chiprow">
            <span class="chip">ğŸ§¾ Issues</span>
          </div>
        </div>

        <form id="issueForm">
          <div class="fgrid">
            <div>
              <label>Ø§Ø³Ù…Ùƒ</label>
              <input name="name" required placeholder="Ø§Ø³Ù…Ùƒ" />
            </div>
            <div>
              <label>ÙˆØ³ÙŠÙ„Ø© ØªÙˆØ§ØµÙ„</label>
              <input name="contact" required placeholder="Discord/Ø±Ù‚Ù…/Ø¥ÙŠÙ…ÙŠÙ„" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <select name="type" required>
              <option value="payment">Ù…Ø´ÙƒÙ„Ø© Ø¯ÙØ¹</option>
              <option value="order">Ù…Ø´ÙƒÙ„Ø© Ø·Ù„Ø¨</option>
              <option value="seller">Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ø¦Ø¹</option>
              <option value="other">Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>

          <div style="margin-top:12px">
            <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <textarea name="details" required placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„â€¦"></textarea>
          </div>

          <div class="actions" style="margin-top:12px">
            <button class="btn ok" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>
            <button class="btn small" type="reset">Ù…Ø³Ø­</button>
          </div>

          <p class="small" id="issueNote" style="margin-top:10px"></p>
        </form>
      </section>

      <!-- ============== SELLER PAGES ============== -->

      <section class="page" id="page-seller-orders">
        <div class="pagehead">
          <div>
            <h2>Seller Panel â€” Orders</h2>
            <p>Ù‡Ù†Ø§ Ù‡ØªØ´ÙˆÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ Ù…Ù†ØªØ¬Ø§ØªÙƒ ÙÙ‚Ø·. ØªÙ‚Ø¯Ø± ØªØ¹Ù…Ù„ Claim Ø«Ù… Done.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="sellerOrdersChip">â€¦</span>
          </div>
        </div>
        <div class="list" id="sellerOrdersList"></div>
      </section>

      <section class="page" id="page-seller-supplies">
        <div class="pagehead">
          <div>
            <h2>Seller Panel â€” Supplies</h2>
            <p>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©. Ù‡ØªØ±ÙˆØ­ Pending Ù„Ù„Ø£ÙˆÙ†Ø±Ø§Øª Ù„Ø­Ø¯ Ù…Ø§ ÙŠØ¹Ù…Ù„ÙˆØ§ Approve.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="sellerPendingChip">â€¦</span>
          </div>
        </div>

        <form id="sellerAddSupplyForm">
          <div class="fgrid">
            <div>
              <label>Ø§Ù„Ù‚Ø³Ù…</label>
              <select name="category" required>
                <option value="nitros">nitros</option>
                <option value="credits">credits</option>
                <option value="visas">visas</option>
                <option value="effects">effects</option>
                <option value="boosts">boosts</option>
                <option value="accounts">accounts</option>
              </select>
            </div>
            <div>
              <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
              <input name="title" required placeholder="Nitro 1 Month" />
            </div>
          </div>

          <div class="fgrid" style="margin-top:12px">
            <div>
              <label>Ø§Ù„Ø³Ø¹Ø± (EGP)</label>
              <input name="price" type="number" min="1" required placeholder="250" />
            </div>
            <div>
              <label>ÙˆØµÙ</label>
              <input name="desc" required placeholder="ÙˆØµÙ Ø³Ø±ÙŠØ¹..." />
            </div>
          </div>

          <div class="actions" style="margin-top:12px">
            <button class="btn ok" type="submit">Ø¥Ø±Ø³Ø§Ù„ (Pending)</button>
            <button class="btn small" type="reset">Ù…Ø³Ø­</button>
          </div>

          <p class="small" id="sellerSupNote" style="margin-top:10px"></p>
        </form>

        <div class="hr"></div>
        <div class="list" id="sellerPendingList"></div>
      </section>

      <!-- ============== OWNER PAGES ============== -->

      <section class="page" id="page-owner-supplies">
        <div class="pagehead">
          <div>
            <h2>Owner Panel â€” Supplies</h2>
            <p>Approve Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† + Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="ownerSupChip">â€¦</span>
          </div>
        </div>

        <div class="grid">
          <div class="card full">
            <h3>Pending Supplies</h3>
            <div class="list" id="ownerPendingSupplies"></div>
          </div>
          <div class="card full">
            <h3>Approved Supplies (Shop)</h3>
            <div class="list" id="ownerApprovedSupplies"></div>
          </div>
        </div>
      </section>

      <section class="page" id="page-owner-members">
        <div class="pagehead">
          <div>
            <h2>Owner Panel â€” Members</h2>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† + Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† + ØªØºÙŠÙŠØ± Owner Key.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="membersChip">â€¦</span>
          </div>
        </div>

        <div class="grid">
          <div class="card full">
            <h3>Owner Key (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø§Ù†Øª Ø¨ØªØ­Ø·Ù‡)</h3>
            <div class="muted">Ù„Ùˆ Ø£ÙˆÙ„ Ù…Ø±Ø©: Ø­Ø· Owner Key Ù‡Ù†Ø§ ÙˆØ¨ÙƒØ¯Ø§ Ø£ÙŠ Owner ÙŠÙ‚Ø¯Ø± ÙŠØ¯Ø®Ù„ Ø¨Ù‡.</div>
            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Owner Key</label>
                <input id="ownerKeyInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯" />
              </div>
              <div>
                <label>Ø­ÙØ¸</label>
                <button class="btn ok" id="saveOwnerKeyBtn">Ø­ÙØ¸ Owner Key</button>
              </div>
            </div>
            <div class="muted" id="ownerKeyNote" style="margin-top:10px"></div>
          </div>

          <div class="card full">
            <h3>Sellers</h3>
            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>ÙŠÙˆØ²Ø± Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                <input id="addSellerInput" placeholder="Ù…Ø«Ø§Ù„: gq_8" />
              </div>
              <div>
                <label>Ø¥Ø¶Ø§ÙØ©</label>
                <button class="btn primary" id="addSellerBtn">+ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø¦Ø¹</button>
              </div>
            </div>
            <div class="list" id="ownersSellersList"></div>
            <div class="muted">Seller Code Ø«Ø§Ø¨Øª: <b style="color:var(--text)">20119</b></div>
          </div>

          <div class="card full">
            <h3>Owners (Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†)</h3>
            <div class="fgrid" style="margin-top:12px">
              <div>
                <label>Ø§Ø³Ù…/ÙŠÙˆØ²Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                <input id="addOwnerInput" placeholder="owner_1" />
              </div>
              <div>
                <label>Ø¥Ø¶Ø§ÙØ©</label>
                <button class="btn primary" id="addOwnerBtn">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø¤ÙˆÙ„</button>
              </div>
            </div>
            <div class="list" id="ownersList"></div>
          </div>
        </div>
      </section>

      <section class="page" id="page-owner-issues">
        <div class="pagehead">
          <div>
            <h2>Owner Panel â€” Issues</h2>
            <p>Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ Ø§Ù„Ù„ÙŠ Ø¬Ø§ÙŠØ© Ù…Ù† Support. Ù„ÙƒÙ„ Ù…Ø´ÙƒÙ„Ø© Ø²Ø± Ø±Ø¯.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="issuesChip">â€¦</span>
          </div>
        </div>
        <div class="list" id="issuesList"></div>
      </section>

      <section class="page" id="page-owner-payments">
        <div class="pagehead">
          <div>
            <h2>Owner Panel â€” Payments Status</h2>
            <p>ÙØ¹Ù‘Ù„/Ø§Ù‚ÙÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù„ÙŠ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´ÙˆØ¨.</p>
          </div>
          <div class="chiprow">
            <span class="chip" id="payStatusChip">â€¦</span>
          </div>
        </div>

        <div class="grid">
          <div class="card full">
            <h3>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</h3>
            <div class="list" id="payStatusList"></div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    // ================== KEYS / CONSTANTS ==================
    const SELLER_CODE = "20119"; // Ø«Ø§Ø¨Øª Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ

    const KEY_ROLE = "voxa_role"; // public | seller | owner
    const KEY_SELLER_USER = "voxa_seller_username";

    const KEY_OWNER_KEY = "voxa_owner_key"; // Ø§Ù†Øª Ø¨ØªØ­Ø·Ù‡ Ù…Ù† Members
    const KEY_OWNERS = "voxa_owners";       // Ø£Ø³Ù…Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†
    const KEY_SELLERS = "voxa_sellers";     // ÙŠÙˆØ²Ø±Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†

    const KEY_SUPPLY = "voxa_supplies";           // approved supplies (shop)
    const KEY_SUPPLY_PENDING = "voxa_supplies_pending"; // seller submissions pending

    const KEY_ORDERS = "voxa_orders";
    const KEY_PROOFS = "voxa_proofs";
    const KEY_ISSUES = "voxa_issues";
    const KEY_CART = "voxa_cart";

    const KEY_PAY_STATUS = "voxa_payments_status";

    const CATEGORIES = ["nitros","credits","visas","effects","boosts","accounts"];

    // ================== DEFAULTS ==================
    const DEFAULT_SELLERS = ["gq_8", "k_i_l_"];
    const DEFAULT_OWNERS  = ["owner"]; // Ø§Ø³Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ØªÙ‚Ø¯Ø± ØªØ´ÙŠÙ„Ù‡/ØªØºÙŠØ±Ù‡
    const DEFAULT_PAY_METHODS = [
      { id:"crypto",    title:"ÙƒØ±ÙŠØ¨ØªÙˆ (USDT / TRC20 / ERC20â€¦)", enabled:true },
      { id:"instapay",  title:"Ø¥Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ", enabled:true },
      { id:"paypal",    title:"Ø¨Ø§ÙŠØ¨Ø§Ù„", enabled:true },
      { id:"vodafone",  title:"ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´", enabled:true },
      { id:"sar",       title:"Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª)", enabled:true },
      { id:"asiacell",  title:"Ø¢Ø³ÙŠØ§ Ø³ÙŠÙ„ (ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª)", enabled:true },
    ];

    // ================== UTILS ==================
    const esc = (s)=> String(s||"")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");

    const uid = (p)=> p + "_" + Math.random().toString(16).slice(2) + Date.now().toString(16);

    function safeJSONParse(raw, fallback){
      try { return JSON.parse(raw); } catch { return fallback; }
    }
    function loadJSON(key, fallback){
      const raw = localStorage.getItem(key);
      return raw ? safeJSONParse(raw, fallback) : fallback;
    }
    function saveJSON(key, value){
      localStorage.setItem(key, JSON.stringify(value));
    }

    function getRole(){ return localStorage.getItem(KEY_ROLE) || "public"; }
    function setRole(role){ localStorage.setItem(KEY_ROLE, role); }
    function getSellerUser(){ return localStorage.getItem(KEY_SELLER_USER) || ""; }
    function setSellerUser(u){ localStorage.setItem(KEY_SELLER_USER, u || ""); }

    function statusHTML(s){
      if (s==="open") return `<span class="status s-open">open</span>`;
      if (s==="done") return `<span class="status s-done">done</span>`;
      return `<span class="status s-closed">closed</span>`;
    }

    function normalizeDiscordLink(contact){
      const c = String(contact||"").trim();
      if (!c) return null;
      if (/^https?:\/\//i.test(c)) return c;
      if (/^\d{10,20}$/.test(c)) return `https://discord.com/users/${c}`;
      return null;
    }

    async function copyText(txt){
      try { await navigator.clipboard.writeText(txt); alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®"); }
      catch { prompt("Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§:", txt); }
    }

    // ================== INIT DEFAULT STORAGE ==================
    if (!localStorage.getItem(KEY_SELLERS)) saveJSON(KEY_SELLERS, DEFAULT_SELLERS);
    if (!localStorage.getItem(KEY_OWNERS)) saveJSON(KEY_OWNERS, DEFAULT_OWNERS);

    if (!localStorage.getItem(KEY_SUPPLY)) saveJSON(KEY_SUPPLY, []);
    if (!localStorage.getItem(KEY_SUPPLY_PENDING)) saveJSON(KEY_SUPPLY_PENDING, []);

    if (!localStorage.getItem(KEY_ORDERS)) saveJSON(KEY_ORDERS, []);
    if (!localStorage.getItem(KEY_PROOFS)) saveJSON(KEY_PROOFS, []);
    if (!localStorage.getItem(KEY_ISSUES)) saveJSON(KEY_ISSUES, []);
    if (!localStorage.getItem(KEY_CART)) saveJSON(KEY_CART, []);

    if (!localStorage.getItem(KEY_PAY_STATUS)) saveJSON(KEY_PAY_STATUS, DEFAULT_PAY_METHODS);

    // ================== MOBILE SIDEBAR ==================
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const openMenu = document.getElementById("openMenu");
    openMenu?.addEventListener("click", ()=>{ sidebar.classList.add("open"); overlay.classList.add("show"); });
    overlay?.addEventListener("click", ()=>{ sidebar.classList.remove("open"); overlay.classList.remove("show"); });

    // ================== PAGES NAV ==================
    const pages = {
      // public
      about: document.getElementById("page-about"),
      shop: document.getElementById("page-shop"),
      sellers: document.getElementById("page-sellers"),
      proofs: document.getElementById("page-proofs"),
      payments: document.getElementById("page-payments"),
      support: document.getElementById("page-support"),

      // seller
      "seller-orders": document.getElementById("page-seller-orders"),
      "seller-supplies": document.getElementById("page-seller-supplies"),

      // owner
      "owner-supplies": document.getElementById("page-owner-supplies"),
      "owner-members": document.getElementById("page-owner-members"),
      "owner-issues": document.getElementById("page-owner-issues"),
      "owner-payments": document.getElementById("page-owner-payments"),
    };

    function setActivePage(key){
      Object.values(pages).forEach(p => p.classList.remove("active"));
      (pages[key] || pages.about).classList.add("active");
      // active button highlight
      document.querySelectorAll(".navbtn").forEach(b=>{
        b.classList.toggle("active", b.dataset.page === key);
      });

      history.replaceState(null, "", "#" + key);

      if (window.innerWidth <= 980){
        sidebar.classList.remove("open");
        overlay.classList.remove("show");
      }
    }

    document.querySelectorAll(".navbtn").forEach(btn=>{
      btn.addEventListener("click", ()=> setActivePage(btn.dataset.page));
    });

    // ================== ROLE UI (SHOW/HIDE NAV) ==================
    const rolePill = document.getElementById("rolePill");
    const sellerPill = document.getElementById("sellerPill");
    const whoChip = document.getElementById("whoChip");

    const navPublic = document.getElementById("navPublic");
    const navSeller = document.getElementById("navSeller");
    const navOwner  = document.getElementById("navOwner");

    function applyRoleUI(){
      const role = getRole();
      const suser = getSellerUser();

      rolePill.textContent = `Role: ${role}`;
      whoChip.textContent = `Role: ${role}`;

      if (role === "seller"){
        sellerPill.classList.remove("hidden");
        sellerPill.textContent = `Seller: @${suser || "â€”"}`;
      } else {
        sellerPill.classList.add("hidden");
      }

      navPublic.classList.toggle("hidden", role !== "public");
      navSeller.classList.toggle("hidden", role !== "seller");
      navOwner.classList.toggle("hidden", role !== "owner");

      // Ù„Ùˆ Ø¯Ø§Ø®Ù„ seller/ownerØŒ Ù†ÙˆØ¯ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ ØµÙØ­Ø© Ø¨ØªØ§Ø¹ØªÙ‡
      const hash = (location.hash || "#about").replace("#","");
      const allowed = getAllowedPagesForRole(role);

      if (!allowed.includes(hash)){
        if (role === "seller") setActivePage("seller-orders");
        else if (role === "owner") setActivePage("owner-supplies");
        else setActivePage("about");
      } else {
        setActivePage(hash);
      }

      renderAll();
    }

    function getAllowedPagesForRole(role){
      if (role === "public") return ["about","shop","sellers","proofs","payments","support"];
      if (role === "seller") return ["seller-orders","seller-supplies"];
      if (role === "owner") return ["owner-supplies","owner-members","owner-issues","owner-payments"];
      return ["about"];
    }

    // ================== LOGIN MODAL ==================
    const loginModal = document.getElementById("loginModal");
    const openLogin = document.getElementById("openLogin");
    const openLogin2 = document.getElementById("openLogin2");
    const closeLogin = document.getElementById("closeLogin");

    const loginRole = document.getElementById("loginRole");
    const loginCode = document.getElementById("loginCode");
    const sellerBox = document.getElementById("sellerBox");
    const sellerUser = document.getElementById("sellerUser");
    const loginNote = document.getElementById("loginNote");
    const doLogin = document.getElementById("doLogin");
    const doLogout = document.getElementById("doLogout");
    const logout2 = document.getElementById("logout2");

    function showLogin(v){
      loginModal.classList.toggle("show", !!v);
      loginNote.textContent = "";
      loginCode.value = "";
      if (v){
        loginRole.value = "seller";
        sellerBox.style.display = "block";
      }
    }

    openLogin?.addEventListener("click", ()=> showLogin(true));
    openLogin2?.addEventListener("click", ()=> showLogin(true));
    closeLogin?.addEventListener("click", ()=> showLogin(false));
    loginModal?.addEventListener("click", (e)=>{ if(e.target === loginModal) showLogin(false); });

    loginRole.addEventListener("change", ()=>{
      const r = loginRole.value;
      sellerBox.style.display = (r === "seller") ? "block" : "none";
    });

    function logout(){
      setRole("public");
      setSellerUser("");
      showLogin(false);
      applyRoleUI();
    }

    doLogout.addEventListener("click", logout);
    logout2.addEventListener("click", logout);

    doLogin.addEventListener("click", ()=>{
      const r = loginRole.value;
      const code = (loginCode.value||"").trim();

      if (r === "seller"){
        const s = (sellerUser.value||"").trim().replace(/^@/,"");
        const sellers = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
        if (code !== SELLER_CODE){
          loginNote.textContent = "âŒ ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ ØºÙ„Ø·.";
          return;
        }
        if (!s){
          loginNote.textContent = "âŒ Ø§ÙƒØªØ¨ ÙŠÙˆØ²Ø± Ø§Ù„Ø¨Ø§Ø¦Ø¹.";
          return;
        }
        if (!sellers.includes(s)){
          loginNote.textContent = "âŒ Ø§Ù„ÙŠÙˆØ²Ø± Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† (Owner Ù„Ø§Ø²Ù… ÙŠØ¶ÙŠÙÙ‡).";
          return;
        }
        setRole("seller");
        setSellerUser(s);
        showLogin(false);
        applyRoleUI();
        return;
      }

      // Owner
      const ownerKey = (localStorage.getItem(KEY_OWNER_KEY) || "").trim();
      if (!ownerKey){
        loginNote.textContent = "âŒ Owner Key Ù…Ø´ Ù…ØªØ­Ø¯Ø¯ Ù„Ø³Ù‡. Ø§Ø¯Ø®Ù„ ÙƒÙ€ Owner Ù„Ø§Ø²Ù… Ø§Ù„Ø£ÙˆÙ„ ØªØ­Ø¯Ø¯Ù‡ Ù…Ù† Owner Panel â†’ Members (Setup).";
        return;
      }
      if (code !== ownerKey){
        loginNote.textContent = "âŒ Owner Key ØºÙ„Ø·.";
        return;
      }
      setRole("owner");
      setSellerUser("");
      showLogin(false);
      applyRoleUI();
    });

    // ================== PUBLIC: SELLERS ==================
    const sellersGrid = document.getElementById("sellersGrid");
    const sellersCountChip = document.getElementById("sellersCountChip");

    function renderSellers(){
      const sellers = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
      sellersCountChip.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†: ${sellers.length}`;
      sellersGrid.innerHTML = sellers.map(u=>`
        <div class="card">
          <h3>@${esc(u)}</h3>
          <p>Ø¨Ø§Ø¦Ø¹ Ù…Ø¹ØªÙ…Ø¯ Ø¯Ø§Ø®Ù„ Voxa.</p>
          <div class="meta">
            <span class="tag ok">Verified</span>
            <span class="tag">24/7</span>
          </div>
        </div>
      `).join("");
    }

    // ================== PUBLIC: PROOFS ==================
    const proofsGrid = document.getElementById("proofsGrid");
    const proofsCountChip = document.getElementById("proofsCountChip");
    function renderProofs(){
      const proofs = loadJSON(KEY_PROOFS, []);
      proofsCountChip.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø«Ø¨Ø§ØªØ§Øª: ${proofs.length}`;

      if(!proofs.length){
        proofsGrid.innerHTML = `<div class="emptybox">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Proofs Ù„Ø³Ù‡.</div>`;
        return;
      }

      proofsGrid.innerHTML = proofs.map(p=>`
        <div class="card">
          <h3>${esc(p.details)}</h3>
          <p>
            Ø§Ù„Ø¹Ù…ÙŠÙ„: <b style="color:var(--text)">${esc(p.customer)}</b><br/>
            Ø§Ø³ØªÙ„Ù…Ù‡Ø§: <b style="color:var(--text)">${esc(p.claimedBy||"â€”")}</b>
          </p>
          <div class="meta">
            <span class="tag ok">Done</span>
            <span class="tag">ÙˆÙ‚Øª: ${p.doneAt ? esc(new Date(p.doneAt).toLocaleString()) : "â€”"}</span>
          </div>
        </div>
      `).join("");
    }

    // ================== PAYMENTS STATUS (PUBLIC VIEW) ==================
    const paymentsGrid = document.getElementById("paymentsGrid");
    const payCountChip = document.getElementById("payCountChip");

    function renderPaymentsPublic(){
      const methods = loadJSON(KEY_PAY_STATUS, DEFAULT_PAY_METHODS);
      const enabled = methods.filter(m=>m.enabled);
      payCountChip.textContent = `Ø§Ù„Ù…ØªØ§Ø­: ${enabled.length} / ${methods.length}`;

      paymentsGrid.innerHTML = enabled.length ? enabled.map(m=>`
        <div class="card">
          <h3>${esc(m.title)}</h3>
          <p>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„ØªØ£ÙƒÙŠØ¯.</p>
          <div class="meta"><span class="tag ok">Ù…ØªØ§Ø­</span></div>
        </div>
      `).join("") : `
        <div class="emptybox">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.
        </div>
      `;
    }

    // ================== SHOP (APPROVED SUPPLIES ONLY) ==================
    const categoryTabs = document.getElementById("categoryTabs");
    const shopGrid = document.getElementById("shopGrid");
    const shopCountChip = document.getElementById("shopCountChip");
    let activeCategory = CATEGORIES[0];

    function loadApprovedSupplies(){
      const arr = loadJSON(KEY_SUPPLY, []);
      return Array.isArray(arr) ? arr : [];
    }

    // Cart
    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");
    const checkoutBox = document.getElementById("checkoutBox");
    const confirmOrderBtn = document.getElementById("confirmOrderBtn");
    const coName = document.getElementById("coName");
    const coContact = document.getElementById("coContact");
    const coPay = document.getElementById("coPay");
    const coNote = document.getElementById("coNote");

    function loadCart(){
      const arr = loadJSON(KEY_CART, []);
      return Array.isArray(arr) ? arr : [];
    }
    function saveCart(arr){ saveJSON(KEY_CART, arr); }
    function cartTotalEGP(cart){
      return cart.reduce((sum,it)=> sum + (Number(it.price)||0) * (Number(it.qty)||1), 0);
    }

    function renderCart(){
      const cart = loadCart();
      if(!cart.length){
        cartList.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.";
        cartTotal.textContent = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 EGP";
        return;
      }

      cartList.innerHTML = cart.map((it,idx)=>`
        <div class="cartItem">
          <div>
            <b style="color:var(--text)">${esc(it.title)}</b>
            <span class="tag">${Number(it.price)||0} EGP</span>
            <span class="tag">x${Number(it.qty)||1}</span>
            <span class="tag">Seller: @${esc(it.seller || "â€”")}</span>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn small" data-minus="${idx}">-</button>
            <button class="btn small" data-plus="${idx}">+</button>
            <button class="btn small danger" data-remove="${idx}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("");

      cartTotal.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${cartTotalEGP(cart)} EGP`;

      cartList.querySelectorAll("[data-plus]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.plus);
          const c=loadCart();
          c[i].qty = (c[i].qty||1)+1;
          saveCart(c); renderCart();
        };
      });
      cartList.querySelectorAll("[data-minus]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.minus);
          const c=loadCart();
          c[i].qty = Math.max(1,(c[i].qty||1)-1);
          saveCart(c); renderCart();
        };
      });
      cartList.querySelectorAll("[data-remove]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.dataset.remove);
          const c=loadCart();
          c.splice(i,1);
          saveCart(c); renderCart();
        };
      });
    }

    function addToCart(prod){
      const cart = loadCart();
      const found = cart.find(x=>x.id===prod.id);
      if(found) found.qty = (found.qty||1)+1;
      else cart.push({ ...prod, qty:1 });
      saveCart(cart);
      renderCart();
    }

    function renderShop(){
      categoryTabs.innerHTML = CATEGORIES.map(c=>`
        <button class="tab ${c===activeCategory ? "active":""}" data-cat="${c}">${c}</button>
      `).join("");
      categoryTabs.querySelectorAll("[data-cat]").forEach(b=>{
        b.onclick=()=>{ activeCategory = b.dataset.cat; renderShop(); };
      });

      const all = loadApprovedSupplies();
      const items = all.filter(p => p.category === activeCategory);
      shopCountChip.textContent = `Approved Products: ${all.length}`;

      if(!items.length){
        shopGrid.innerHTML = `
          <div class="emptybox">
            <b style="color:var(--text)">Ù‚Ø³Ù…: ${activeCategory}</b><br/>
            Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø¯Ù‡.
          </div>
        `;
        renderCart();
        return;
      }

      shopGrid.innerHTML = items.map(p=>`
        <div class="card">
          <h3>${esc(p.title)}</h3>
          <p>${esc(p.desc)}</p>
          <div class="meta">
            <span class="tag">${Number(p.price)||0} EGP</span>
            <span class="tag">Seller: @${esc(p.seller || "â€”")}</span>
          </div>
          <div class="actions">
            <button class="btn primary" data-buy="${esc(p.id)}">Ø´Ø±Ø§Ø¡</button>
            <button class="btn ok" data-add="${esc(p.id)}">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
          </div>
        </div>
      `).join("");

      shopGrid.querySelectorAll("[data-add]").forEach(btn=>{
        btn.onclick=()=>{
          const id = btn.dataset.add;
          const prod = loadApprovedSupplies().find(x=>x.id===id);
          if(!prod) return;
          addToCart({ id: prod.id, title: prod.title, price: Number(prod.price)||0, seller: prod.seller||"", category: prod.category });
          alert("âœ… Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø©");
        };
      });

      shopGrid.querySelectorAll("[data-buy]").forEach(btn=>{
        btn.onclick=()=>{
          const id = btn.dataset.buy;
          const prod = loadApprovedSupplies().find(x=>x.id===id);
          if(!prod) return;
          addToCart({ id: prod.id, title: prod.title, price: Number(prod.price)||0, seller: prod.seller||"", category: prod.category });
          checkoutBox.style.display = "block";
          window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
        };
      });

      renderCart();
    }

    // payments select in checkout (enabled only)
    function renderCheckoutPayments(){
      const methods = loadJSON(KEY_PAY_STATUS, DEFAULT_PAY_METHODS);
      const enabled = methods.filter(m=>m.enabled);
      coPay.innerHTML = enabled.map(m=>`<option value="${esc(m.id)}">${esc(m.title)}</option>`).join("");
    }

    // checkout actions
    clearCartBtn.onclick = ()=>{
      saveCart([]);
      renderCart();
      coNote.textContent = "";
    };

    checkoutBtn.onclick = ()=>{
      checkoutBox.style.display = (checkoutBox.style.display === "block") ? "none" : "block";
      coNote.textContent = "";
    };

    confirmOrderBtn.onclick = ()=>{
      const name = (coName.value||"").trim();
      const contact = (coContact.value||"").trim();
      const pay = coPay.value;

      const cart = loadCart();
      if(!cart.length){ coNote.textContent = "âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©."; return; }
      if(!name || !contact){ coNote.textContent = "âŒ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„."; return; }

      const total = cartTotalEGP(cart);
      const details = cart.map(x=>`${x.title} x${x.qty}`).join(" | ");

      const orders = loadJSON(KEY_ORDERS, []);
      orders.unshift({
        id: Date.now().toString(),
        at: new Date().toISOString(),
        customer: name,
        contact: contact,
        pay: pay,
        total: total,
        items: cart.map(x=>({ id:x.id, title:x.title, qty:x.qty, price:x.price, seller:x.seller, category:x.category })),
        details: `${details} | Pay:${pay} | Total:${total} EGP`,
        status: "open",
        claimState: "unclaimed",
        claimedBy: "",
        claimedAt: ""
      });
      saveJSON(KEY_ORDERS, orders);

      saveCart([]);
      renderCart();

      coName.value = "";
      coContact.value = "";
      coNote.textContent = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨! (Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†/Ø§Ù„Ø£ÙˆÙ†Ø±Ø§Øª Ù‡ÙŠØ´ÙˆÙÙˆÙ‡ ÙÙŠ Orders).";
    };

    // ================== SUPPORT -> ISSUES ==================
    const issueForm = document.getElementById("issueForm");
    const issueNote = document.getElementById("issueNote");

    issueForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const fd = new FormData(issueForm);
      const issue = {
        id: uid("i"),
        at: new Date().toISOString(),
        name: String(fd.get("name")||"").trim(),
        contact: String(fd.get("contact")||"").trim(),
        type: String(fd.get("type")||"").trim(),
        details: String(fd.get("details")||"").trim(),
        status: "open",
        replies: []
      };
      const all = loadJSON(KEY_ISSUES, []);
      all.unshift(issue);
      saveJSON(KEY_ISSUES, all);

      issueNote.textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©. Ù‡ØªØ¸Ù‡Ø± Ù„Ù„Ø£ÙˆÙ†Ø±Ø§Øª ÙÙŠ Issues.";
      issueForm.reset();
      setTimeout(()=> issueNote.textContent = "", 3000);
    });

    // ================== SELLER: ORDERS ==================
    const sellerOrdersList = document.getElementById("sellerOrdersList");
    const sellerOrdersChip = document.getElementById("sellerOrdersChip");

    function getSellerOrders(){
      const s = getSellerUser();
      const orders = loadJSON(KEY_ORDERS, []);
      // Ø§Ù„Ø·Ù„Ø¨ ÙŠØ¹ØªØ¨Ø± Ù„Ù„Ø¨Ø§Ø¦Ø¹ Ù„Ùˆ ÙÙŠÙ‡ item seller Ø¨ØªØ§Ø¹Ù‡
      return orders.filter(o => Array.isArray(o.items) && o.items.some(it => (it.seller||"") === s));
    }

    function renderSellerOrders(){
      const s = getSellerUser();
      const orders = getSellerOrders();
      sellerOrdersChip.textContent = `@${s || "â€”"} â€” Orders: ${orders.length}`;

      if (!orders.length){
        sellerOrdersList.innerHTML = `<div class="emptybox">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø¨Ø§Ø¦Ø¹ Ø¯Ù‡.</div>`;
        return;
      }

      sellerOrdersList.innerHTML = orders.map(o=>{
        const claimState = o.claimState || (o.claimedBy ? "claimed" : "unclaimed");
        const isClaimed = (claimState === "claimed");

        // Ø¹Ø±Ø¶ items Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙÙ‚Ø·
        const myItems = (o.items||[]).filter(it => (it.seller||"") === s)
          .map(it=> `${it.title} x${it.qty}`).join(" | ");

        const link = normalizeDiscordLink(o.contact);
        const commBtn = link
          ? `<a class="btn small" href="${link}" target="_blank" rel="noopener">ÙØªØ­ ØªÙˆØ§ØµÙ„</a>`
          : `<button class="btn small" data-copy-contact="${esc(o.contact)}">Ù†Ø³Ø® Ø§Ù„ØªÙˆØ§ØµÙ„</button>`;

        return `
          <div class="item">
            <div class="itemTop">
              <div class="itemTitle">${esc(myItems)}</div>
              ${statusHTML(o.status || "open")}
            </div>
            <div class="muted" style="margin-top:6px">
              Ø§Ù„Ø¹Ù…ÙŠÙ„: <b style="color:var(--text)">${esc(o.customer)}</b> â€”
              ØªÙˆØ§ØµÙ„: <b style="color:var(--text)">${esc(o.contact)}</b><br/>
              Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨: <b style="color:var(--text)">${Number(o.total)||0} EGP</b> â€”
              Pay: <b style="color:var(--text)">${esc(o.pay||"â€”")}</b><br/>
              ÙˆÙ‚Øª: ${new Date(o.at).toLocaleString()}<br/>
              ${isClaimed ? `Ù…Ø³ØªÙ„Ù… Ø¨ÙˆØ§Ø³Ø·Ø©: <b style="color:var(--text)">${esc(o.claimedBy||"â€”")}</b>` : `ØºÙŠØ± Ù…Ø³ØªÙ„Ù…`}
            </div>

            <div class="actions">
              ${!isClaimed ? `<button class="btn ok small" data-claim="${o.id}">Ø§Ø³ØªÙ„Ø§Ù…</button>` : ``}
              ${isClaimed ? `<button class="btn ok small" data-done="${o.id}">done</button>` : ``}
              ${commBtn}
            </div>
          </div>
        `;
      }).join("");

      sellerOrdersList.querySelectorAll("[data-copy-contact]").forEach(btn=>{
        btn.addEventListener("click", ()=> copyText(btn.getAttribute("data-copy-contact")||""));
      });

      // claim
      sellerOrdersList.querySelectorAll("[data-claim]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-claim");
          const ordersAll = loadJSON(KEY_ORDERS, []);
          const it = ordersAll.find(x=>x.id===id);
          if(!it) return;

          it.claimState = "claimed";
          it.claimedBy = `seller:@${getSellerUser()}`;
          it.claimedAt = new Date().toISOString();

          saveJSON(KEY_ORDERS, ordersAll);

          const link = normalizeDiscordLink(it.contact);
          if(link) window.open(link, "_blank", "noopener");

          renderAll();
        });
      });

      // done -> move to proofs
      sellerOrdersList.querySelectorAll("[data-done]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-done");
          const ordersAll = loadJSON(KEY_ORDERS, []);
          const it = ordersAll.find(x=>x.id===id);
          if(!it) return;

          const claimState = it.claimState || (it.claimedBy ? "claimed" : "unclaimed");
          if(claimState !== "claimed"){
            alert("âŒ Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£ÙˆÙ„.");
            return;
          }

          // Move whole order to proofs (Ø²ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…)
          const newOrders = ordersAll.filter(x=>x.id!==id);
          saveJSON(KEY_ORDERS, newOrders);

          const proofs = loadJSON(KEY_PROOFS, []);
          proofs.unshift({ ...it, status:"done", doneAt:new Date().toISOString() });
          saveJSON(KEY_PROOFS, proofs);

          renderAll();
        });
      });
    }

    // ================== SELLER: SUPPLIES (PENDING) ==================
    const sellerAddSupplyForm = document.getElementById("sellerAddSupplyForm");
    const sellerSupNote = document.getElementById("sellerSupNote");
    const sellerPendingList = document.getElementById("sellerPendingList");
    const sellerPendingChip = document.getElementById("sellerPendingChip");

    function getSellerPending(){
      const s = getSellerUser();
      const pend = loadJSON(KEY_SUPPLY_PENDING, []);
      return pend.filter(p => (p.bySeller||"") === s);
    }

    function renderSellerPending(){
      const list = getSellerPending();
      sellerPendingChip.textContent = `Pending: ${list.length}`;

      if(!list.length){
        sellerPendingList.innerHTML = `<div class="emptybox">Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª Pending Ù„ÙŠÙƒ.</div>`;
        return;
      }

      sellerPendingList.innerHTML = list.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="muted">(${esc(p.category)})</span></div>
            <span class="status s-open">pending</span>
          </div>
          <div class="muted" style="margin-top:6px">
            Ø§Ù„Ø³Ø¹Ø±: <b style="color:var(--text)">${Number(p.price)||0} EGP</b><br/>
            Ø§Ù„ÙˆØµÙ: ${esc(p.desc)}<br/>
            ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${p.at ? new Date(p.at).toLocaleString() : "â€”"}
          </div>
        </div>
      `).join("");
    }

    sellerAddSupplyForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      if (getRole() !== "seller"){
        sellerSupNote.textContent = "âŒ Ù„Ø§Ø²Ù… ØªØ¯Ø®Ù„ ÙƒØ¨Ø§Ø¦Ø¹.";
        return;
      }

      const fd = new FormData(sellerAddSupplyForm);
      const category = String(fd.get("category")||"").trim();
      const title = String(fd.get("title")||"").trim();
      const price = Number(fd.get("price")||0);
      const desc = String(fd.get("desc")||"").trim();

      if (!CATEGORIES.includes(category) || !title || !price || !desc){
        sellerSupNote.textContent = "âŒ Ø§ÙƒØªØ¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­.";
        return;
      }

      const pend = loadJSON(KEY_SUPPLY_PENDING, []);
      pend.unshift({
        id: uid("pend"),
        at: new Date().toISOString(),
        category, title, price, desc,
        bySeller: getSellerUser()
      });
      saveJSON(KEY_SUPPLY_PENDING, pend);

      sellerAddSupplyForm.reset();
      sellerSupNote.textContent = "âœ… Ø§ØªØ¨Ø¹ØªØª Pending Ù„Ù„Ø£ÙˆÙ†Ø±Ø§Øª.";
      setTimeout(()=> sellerSupNote.textContent="", 2500);

      renderAll();
    });

    // ================== OWNER: SUPPLIES (APPROVE + MANAGE) ==================
    const ownerPendingSupplies = document.getElementById("ownerPendingSupplies");
    const ownerApprovedSupplies = document.getElementById("ownerApprovedSupplies");
    const ownerSupChip = document.getElementById("ownerSupChip");

    function renderOwnerSupplies(){
      const pend = loadJSON(KEY_SUPPLY_PENDING, []);
      const appr = loadJSON(KEY_SUPPLY, []);
      ownerSupChip.textContent = `Pending: ${pend.length} â€” Approved: ${appr.length}`;

      ownerPendingSupplies.innerHTML = pend.length ? pend.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="muted">(${esc(p.category)})</span></div>
            <span class="status s-open">pending</span>
          </div>
          <div class="muted" style="margin-top:6px">
            Seller: <b style="color:var(--text)">@${esc(p.bySeller||"â€”")}</b><br/>
            Ø§Ù„Ø³Ø¹Ø±: <b style="color:var(--text)">${Number(p.price)||0} EGP</b><br/>
            Ø§Ù„ÙˆØµÙ: ${esc(p.desc)}<br/>
            ÙˆÙ‚Øª: ${p.at ? new Date(p.at).toLocaleString() : "â€”"}
          </div>
          <div class="actions">
            <button class="btn ok small" data-approve="${p.id}">Approve</button>
            <button class="btn danger small" data-reject="${p.id}">Reject</button>
          </div>
        </div>
      `).join("") : `<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Pending.</div>`;

      ownerApprovedSupplies.innerHTML = appr.length ? appr.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="muted">(${esc(p.category)})</span></div>
            <span class="status s-done">${Number(p.price)||0} EGP</span>
          </div>
          <div class="muted" style="margin-top:6px">
            Seller: <b style="color:var(--text)">@${esc(p.seller||"â€”")}</b><br/>
            ${esc(p.desc)}
          </div>
          <div class="actions">
            <button class="btn small danger" data-del-approved="${p.id}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Approved Supplies.</div>`;

      // Approve
      ownerPendingSupplies.querySelectorAll("[data-approve]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-approve");
          const pend2 = loadJSON(KEY_SUPPLY_PENDING, []);
          const it = pend2.find(x=>x.id===id);
          if(!it) return;

          // remove from pending
          saveJSON(KEY_SUPPLY_PENDING, pend2.filter(x=>x.id!==id));

          // add to approved
          const appr2 = loadJSON(KEY_SUPPLY, []);
          appr2.unshift({
            id: uid("p"),
            at: new Date().toISOString(),
            category: it.category,
            title: it.title,
            price: Number(it.price)||0,
            seller: it.bySeller || "",
            desc: it.desc
          });
          saveJSON(KEY_SUPPLY, appr2);

          renderAll();
        });
      });

      // Reject
      ownerPendingSupplies.querySelectorAll("[data-reject]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-reject");
          const pend2 = loadJSON(KEY_SUPPLY_PENDING, []);
          saveJSON(KEY_SUPPLY_PENDING, pend2.filter(x=>x.id!==id));
          renderAll();
        });
      });

      // Delete approved
      ownerApprovedSupplies.querySelectorAll("[data-del-approved]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del-approved");
          const appr2 = loadJSON(KEY_SUPPLY, []).filter(x=>x.id!==id);
          saveJSON(KEY_SUPPLY, appr2);
          renderAll();
        });
      });
    }

    // ================== OWNER: MEMBERS ==================
    const addSellerInput = document.getElementById("addSellerInput");
    const addSellerBtn = document.getElementById("addSellerBtn");
    const ownersSellersList = document.getElementById("ownersSellersList");

    const addOwnerInput = document.getElementById("addOwnerInput");
    const addOwnerBtn = document.getElementById("addOwnerBtn");
    const ownersList = document.getElementById("ownersList");

    const membersChip = document.getElementById("membersChip");

    const ownerKeyInput = document.getElementById("ownerKeyInput");
    const saveOwnerKeyBtn = document.getElementById("saveOwnerKeyBtn");
    const ownerKeyNote = document.getElementById("ownerKeyNote");

    function renderMembers(){
      const sellers = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
      const owners  = loadJSON(KEY_OWNERS, DEFAULT_OWNERS);
      membersChip.textContent = `Sellers: ${sellers.length} â€” Owners: ${owners.length}`;

      ownersSellersList.innerHTML = sellers.length ? sellers.map(s=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">@${esc(s)}</div>
            <span class="status s-done">seller</span>
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-seller="${esc(s)}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Sellers.</div>`;

      ownersList.innerHTML = owners.length ? owners.map(o=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(o)}</div>
            <span class="status s-done">owner</span>
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-owner="${esc(o)}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Owners.</div>`;

      ownersSellersList.querySelectorAll("[data-del-seller]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const u = btn.getAttribute("data-del-seller");
          const arr = loadJSON(KEY_SELLERS, DEFAULT_SELLERS).filter(x=>x!==u);
          saveJSON(KEY_SELLERS, arr);
          renderAll();
        });
      });

      ownersList.querySelectorAll("[data-del-owner]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const u = btn.getAttribute("data-del-owner");
          const arr = loadJSON(KEY_OWNERS, DEFAULT_OWNERS).filter(x=>x!==u);
          saveJSON(KEY_OWNERS, arr);
          renderAll();
        });
      });

      const ok = (localStorage.getItem(KEY_OWNER_KEY)||"").trim();
      ownerKeyNote.textContent = ok ? `âœ… Owner Key Ù…ÙˆØ¬ÙˆØ¯ (Ù…Ø´ Ù‡Ù†Ø¸Ù‡Ø±Ù‡ Ù‡Ù†Ø§).` : `âš ï¸ Owner Key Ù…Ø´ Ù…ØªØ­Ø¯Ø¯ Ù„Ø³Ù‡.`;
    }

    addSellerBtn.addEventListener("click", ()=>{
      const u = (addSellerInput.value||"").trim().replace(/^@/,"");
      if(!u) return;
      const arr = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
      if(!arr.includes(u)) arr.unshift(u);
      saveJSON(KEY_SELLERS, arr);
      addSellerInput.value = "";
      renderAll();
    });

    addOwnerBtn.addEventListener("click", ()=>{
      const u = (addOwnerInput.value||"").trim();
      if(!u) return;
      const arr = loadJSON(KEY_OWNERS, DEFAULT_OWNERS);
      if(!arr.includes(u)) arr.unshift(u);
      saveJSON(KEY_OWNERS, arr);
      addOwnerInput.value = "";
      renderAll();
    });

    saveOwnerKeyBtn.addEventListener("click", ()=>{
      const k = (ownerKeyInput.value||"").trim();
      if(!k){
        ownerKeyNote.textContent = "âŒ Ø§ÙƒØªØ¨ Owner Key.";
        return;
      }
      localStorage.setItem(KEY_OWNER_KEY, k);
      ownerKeyInput.value = "";
      ownerKeyNote.textContent = "âœ… ØªÙ… Ø­ÙØ¸ Owner Key.";
      setTimeout(()=> renderAll(), 200);
    });

    // ================== OWNER: ISSUES ==================
    const issuesList = document.getElementById("issuesList");
    const issuesChip = document.getElementById("issuesChip");

    function renderIssues(){
      const list = loadJSON(KEY_ISSUES, []);
      issuesChip.textContent = `Issues: ${list.length}`;

      issuesList.innerHTML = list.length ? list.map(i=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">Issue: ${esc(i.type)}</div>
            ${statusHTML(i.status)}
          </div>
          <div class="muted" style="margin-top:6px">
            Ù…Ù†: <b style="color:var(--text)">${esc(i.name)}</b> â€”
            ØªÙˆØ§ØµÙ„: <b style="color:var(--text)">${esc(i.contact)}</b><br/>
            ÙˆÙ‚Øª: ${new Date(i.at).toLocaleString()}<br/>
            Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${esc(i.details)}
          </div>

          ${(Array.isArray(i.replies) && i.replies.length) ? `
            <div class="muted" style="margin-top:10px">
              <b style="color:var(--text)">Ø¢Ø®Ø± Ø±Ø¯:</b> ${esc(i.replies[0].msg)}<br/>
              <span style="opacity:.85">${new Date(i.replies[0].at).toLocaleString()}</span>
            </div>
          ` : ""}

          <div class="actions">
            <button class="btn primary small" data-reply="${i.id}">Ø±Ø¯</button>
            <button class="btn ok small" data-i-set="done" data-iid="${i.id}">done</button>
            <button class="btn danger small" data-i-set="closed" data-iid="${i.id}">closed</button>
            <button class="btn small" data-i-del="${i.id}">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join("") : `<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Issues.</div>`;

      issuesList.querySelectorAll("[data-i-set]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-iid");
          const st = btn.getAttribute("data-i-set");
          const arr = loadJSON(KEY_ISSUES, []);
          const it = arr.find(x=>x.id===id);
          if (it){ it.status = st; saveJSON(KEY_ISSUES, arr); renderAll(); }
        });
      });

      issuesList.querySelectorAll("[data-i-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-i-del");
          const arr = loadJSON(KEY_ISSUES, []).filter(x=>x.id!==id);
          saveJSON(KEY_ISSUES, arr);
          renderAll();
        });
      });

      issuesList.querySelectorAll("[data-reply]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-reply");
          const msg = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯:");
          if (!msg) return;

          const arr = loadJSON(KEY_ISSUES, []);
          const it = arr.find(x=>x.id===id);
          if (!it) return;

          if (!Array.isArray(it.replies)) it.replies = [];
          it.replies.unshift({ at: new Date().toISOString(), msg: msg.trim() });
          it.status = "done";
          saveJSON(KEY_ISSUES, arr);

          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø¯.");
          renderAll();
        });
      });
    }

    // ================== OWNER: PAYMENTS STATUS ==================
    const payStatusList = document.getElementById("payStatusList");
    const payStatusChip = document.getElementById("payStatusChip");

    function renderPayStatusOwner(){
      const methods = loadJSON(KEY_PAY_STATUS, DEFAULT_PAY_METHODS);
      const enabled = methods.filter(m=>m.enabled).length;
      payStatusChip.textContent = `Enabled: ${enabled} / ${methods.length}`;

      payStatusList.innerHTML = methods.map(m=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(m.title)}</div>
            <span class="status ${m.enabled ? "s-done" : "s-closed"}">${m.enabled ? "enabled" : "disabled"}</span>
          </div>
          <div class="actions">
            <button class="btn ${m.enabled ? "danger" : "ok"} small" data-toggle-pay="${esc(m.id)}">
              ${m.enabled ? "Ù‚ÙÙ„" : "ØªÙØ¹ÙŠÙ„"}
            </button>
          </div>
        </div>
      `).join("");

      payStatusList.querySelectorAll("[data-toggle-pay]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-toggle-pay");
          const arr = loadJSON(KEY_PAY_STATUS, DEFAULT_PAY_METHODS);
          const it = arr.find(x=>x.id===id);
          if(!it) return;
          it.enabled = !it.enabled;
          saveJSON(KEY_PAY_STATUS, arr);
          renderAll();
        });
      });
    }

    // ================== GLOBAL RENDER ==================
    function renderAll(){
      // public
      renderSellers();
      renderProofs();
      renderPaymentsPublic();
      renderCheckoutPayments();
      renderShop();

      // role-based
      if (getRole() === "seller"){
        renderSellerOrders();
        renderSellerPending();
      }
      if (getRole() === "owner"){
        renderOwnerSupplies();
        renderMembers();
        renderIssues();
        renderPayStatusOwner();
      }
    }

    // ================== HASH INIT ==================
    window.addEventListener("hashchange", ()=> applyRoleUI());

    // ================== FIRST LOAD ==================
    // set default active category
    const hasSup = loadApprovedSupplies();
    activeCategory = CATEGORIES[0];

    applyRoleUI();

    // sync across tabs
    window.addEventListener("storage", ()=> applyRoleUI());
  </script>
</body>
</html>
